<!DOCTYPE HTML>
<html lang="en" class="navy" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>AUTD3 Developers Manual v18.0.1</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./theme/codeblock_filename.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('navy')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="about_AUTD3.html"><strong aria-hidden="true">1.</strong> About AUTD3</a></li><li class="chapter-item expanded "><a href="Users_Manual/users_manual.html"><strong aria-hidden="true">2.</strong> SDK User's Manual</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/concept.html"><strong aria-hidden="true">2.1.</strong> Concept</a></li><li class="chapter-item expanded "><a href="Users_Manual/getting_started.html"><strong aria-hidden="true">2.2.</strong> Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/getting_started/rust.html"><strong aria-hidden="true">2.2.1.</strong> Rust</a></li><li class="chapter-item expanded "><a href="Users_Manual/getting_started/cpp.html"><strong aria-hidden="true">2.2.2.</strong> C++</a></li><li class="chapter-item expanded "><a href="Users_Manual/getting_started/cs.html"><strong aria-hidden="true">2.2.3.</strong> C#</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/getting_started/unity.html"><strong aria-hidden="true">2.2.3.1.</strong> Unity</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/getting_started/python.html"><strong aria-hidden="true">2.2.4.</strong> Python</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/versioning.html"><strong aria-hidden="true">2.3.</strong> Versioning</a></li><li class="chapter-item expanded "><a href="Users_Manual/geometry.html"><strong aria-hidden="true">2.4.</strong> Geometry</a></li><li class="chapter-item expanded "><a href="Users_Manual/link.html"><strong aria-hidden="true">2.5.</strong> Link</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/link/twincat.html"><strong aria-hidden="true">2.5.1.</strong> TwinCAT</a></li><li class="chapter-item expanded "><a href="Users_Manual/link/soem.html"><strong aria-hidden="true">2.5.2.</strong> SOEM</a></li><li class="chapter-item expanded "><a href="Users_Manual/link/simulator.html"><strong aria-hidden="true">2.5.3.</strong> Simulator</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/gain.html"><strong aria-hidden="true">2.6.</strong> Gain</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/gain/null.html"><strong aria-hidden="true">2.6.1.</strong> Null</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/focus.html"><strong aria-hidden="true">2.6.2.</strong> Focus</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/bessel.html"><strong aria-hidden="true">2.6.3.</strong> Bessel</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/plane.html"><strong aria-hidden="true">2.6.4.</strong> Plane</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/uniform.html"><strong aria-hidden="true">2.6.5.</strong> Uniform</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/grouped.html"><strong aria-hidden="true">2.6.6.</strong> Group</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/holo.html"><strong aria-hidden="true">2.6.7.</strong> Holo</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/cache.html"><strong aria-hidden="true">2.6.8.</strong> Cache</a></li><li class="chapter-item expanded "><a href="Users_Manual/gain/transform.html"><strong aria-hidden="true">2.6.9.</strong> Transform</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/modulation.html"><strong aria-hidden="true">2.7.</strong> Modulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/modulation/static.html"><strong aria-hidden="true">2.7.1.</strong> Static</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/sine.html"><strong aria-hidden="true">2.7.2.</strong> Sine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/modulation/fourier.html"><strong aria-hidden="true">2.7.2.1.</strong> Fourier</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/square.html"><strong aria-hidden="true">2.7.3.</strong> Square</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/wav.html"><strong aria-hidden="true">2.7.4.</strong> Wav</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/rawpcm.html"><strong aria-hidden="true">2.7.5.</strong> RawPCM</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/cache.html"><strong aria-hidden="true">2.7.6.</strong> Cache</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/radiation.html"><strong aria-hidden="true">2.7.7.</strong> Radiation</a></li><li class="chapter-item expanded "><a href="Users_Manual/modulation/transform.html"><strong aria-hidden="true">2.7.8.</strong> Transform</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/stm.html"><strong aria-hidden="true">2.8.</strong> Spatio-Temporal Modulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/stm/focus.html"><strong aria-hidden="true">2.8.1.</strong> FocusSTM</a></li><li class="chapter-item expanded "><a href="Users_Manual/stm/gain.html"><strong aria-hidden="true">2.8.2.</strong> GainSTM</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/silencer.html"><strong aria-hidden="true">2.9.</strong> Silencer</a></li><li class="chapter-item expanded "><a href="Users_Manual/controller.html"><strong aria-hidden="true">2.10.</strong> Controller</a></li><li class="chapter-item expanded "><a href="Users_Manual/advanced_examples/advanced_examples.html"><strong aria-hidden="true">2.11.</strong> Advanced examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Users_Manual/advanced_examples/custom_gain.html"><strong aria-hidden="true">2.11.1.</strong> Custom Gain</a></li><li class="chapter-item expanded "><a href="Users_Manual/advanced_examples/custom_modulation.html"><strong aria-hidden="true">2.11.2.</strong> Custom Modulation</a></li></ol></li><li class="chapter-item expanded "><a href="Users_Manual/Simulator/simulator.html"><strong aria-hidden="true">2.12.</strong> Simulaotr</a></li><li class="chapter-item expanded "><a href="Users_Manual/FAQ/faq.html"><strong aria-hidden="true">2.13.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="Users_Manual/Citation/citation.html"><strong aria-hidden="true">2.14.</strong> Citation</a></li><li class="chapter-item expanded "><a href="Users_Manual/LICENSE.html"><strong aria-hidden="true">2.15.</strong> License</a></li><li class="chapter-item expanded "><a href="Users_Manual/release_notes.html"><strong aria-hidden="true">2.16.</strong> Release notes</a></li></ol></li><li class="chapter-item expanded "><a href="document_history.html"><strong aria-hidden="true">3.</strong> Document history</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AUTD3 Developers Manual v18.0.1</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shinolab/autd3" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="about-autd3"><a class="header" href="#about-autd3">About AUTD3</a></h1>
<p>AUTD3 is an airborne ultrasound phased array device for midair haptics.
A phased array is an array of ultrasound transducers that can control the phase of each transducer individually.
By controlling the phase of the ultrasound, an arbitrary sound field can be generated in space.</p>
<p>The energy of sound waves that are well focused using a phased array produces acoustic radiation pressure.
This pressure can be used to press the surface of the human body without any contact.
The position of the focused focal point can be freely controlled by electronically controlling the phased array.
Moreover, by solving the inverse problem, not only a single focal point but also a more complicated spatial distribution of sound pressure can be created.</p>
<p>The upper limit of the magnitude of pressure that can be generated by the phased array is currently about <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">50</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mN/c</span><span class="mord"><span class="mord mathrm">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">5</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">gf/c</span><span class="mord"><span class="mord mathrm">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span>.
Also, the spatial resolution is limited to about the wavelength (for example, about <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">8.5</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span> for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">40</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span>).
Despite these limitations, phased arrays have attracted attention as a technology that allows us to freely design the spatio-temporal distribution of force and create various tactile sensations.</p>
<p>We call this field of non-contact tactile stimulation technology <strong>Midair Haptics</strong>, and we call this phased array device <strong>Airborne Ultrasound Tactile Display (AUTD)</strong>.
The essential part of AUTD was proposed and established by the University of Tokyo between 2008<sup class="footnote-reference"><a href="#1">1</a></sup> and the early 2010s<sup class="footnote-reference"><a href="#2">2</a></sup>.
Since then, universities and companies from various countries have entered into this field, and active research and development has been conducted.
AUTD3 is the third version of AUTD developed in Shinoda-Makino Laboratory of the University of Tokyo.</p>
<p>A list of research using AUTD can be found at <a href="https://hapislab.org/en/airborne-ultrasound-tactile-display">our laboratory’s homepage</a>. Please also refer to this page.</p>
<p>This manual describes the <a href="https://github.com/shinolab/autd3">autd3</a> software library for operating AUTD3.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://hapislab.org/public/hiroyuki_shinoda/research/pdf/08Eurohaptics_iwamoto.pdf">Takayuki Iwamoto, Mari Tatezono, and Hiroyuki Shinoda: Non-contact Method for Producing Tactile Sensation Using Airborne Ultrasound, Haptics: Perception, Devices and Scenarios: 6th International Conference, Eurohaptics 2008 Proceedings (Lecture Notes in Computer Science), pp.504-513, 2008.</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://hapislab.org/public/hiroyuki_shinoda/research/pdf/10_Trans_Haptics_Hoshi.pdf">Takayuki Hoshi, Masafumi Takahashi, Takayuki Iwamoto, and Hiroyuki Shinoda: Noncontact Tactile Display Based on Radiation Pressure of Airborne Ultrasound, IEEE Trans. on Haptics, Vol. 3, No. 3, pp.155-165, 2010.</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="users-manual"><a class="header" href="#users-manual">User’s Manual</a></h1>
<p>In the following, we describe the basic usage of the library.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="concept"><a class="header" href="#concept">Concept</a></h1>
<p>The following is a basic components of AUTD3 SDK.</p>
<ul>
<li><code>Controller</code> - Controller class. All operations to AUTD3 are done via this class</li>
<li><code>Geometry</code> - Container of <code>Device</code>
<ul>
<li><code>Device</code> - Class corresponding to AUTD3 device</li>
</ul>
</li>
<li><code>Link</code> - Interface to AUTD3 devices</li>
<li><code>Gain</code> - Manage the phase/amplitude of each transducer</li>
<li><code>Modulation</code> - Manage the amplitude modulation (AM) of each transducer</li>
<li><code>STM</code> - Manage the spatio-temporal modulation (STM) on firmware</li>
</ul>
<p>The following is the front and back photos of AUTD3.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/autd_trans_idx.jpg"/>
  <figcaption>Front photo of AUTD3 device</figcaption>
</figure>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/autd_back.jpg"/>
  <figcaption>Back photo of AUTD3 device</figcaption>
</figure>
<p>AUTD3 is composed of 249 transducers per device<sup class="footnote-reference"><a href="#fn_asm">1</a></sup>.
From SDK, the phase/amplitude of all transducers can be specified individually.
The coordinate system of AUTD3 adopts the right-handed coordinate system, and the center of the 0th transducer is the origin.
The x-axis is the long axis direction, that is, the direction of 0→17, and the y-axis is the direction of 0→18.
In addition, the unit system is mm for distance, rad for angle, and Hz for frequency.
The transducers are arranged at intervals of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">10.16</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span>, and the size including the substrate is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">192</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">151.4</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span>.</p>
<p>The followings is the dimension of transducer array.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/transducers_array.jpg"/>
  <figcaption>The dimension of transducer array</figcaption>
</figure>
<p>In addition, AUTD3 can be connected to each other via the daisy chain.
You can compose extended array by connecting the EherCAT In of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>-th device and the EherCAT Out of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>-th device with an Ethernet cable.
(The ethernet cable must be CAT 5e or higher.)</p>
<p>You have to supply <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">24</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">V</span></span></span></span></span> DC power to AUTD3.
The power line can be connected to each other, and any of the three power connectors can be used.
The power connector is Molex 5566-02A.</p>
<blockquote>
<p>Note: AUTD3 consumes up to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">A</span></span></span></span></span> of current per device. Please pay attention to the maximum output current of the power supply.</p>
</blockquote>
<div class="footnote-definition" id="fn_asm"><sup class="footnote-definition-label">1</sup>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">18</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">14</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">252</span></span></span></span> transducers are mounted on the substrate, but 3 transducers are missing for the screw holes. The reason why the screw holes are placed at this position is to minimize the gap when multiple devices are placed side by side.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="tutorial"><a class="header" href="#tutorial">Tutorial</a></h1>
<h2 id="installation-of-dependencies"><a class="header" href="#installation-of-dependencies">Installation of dependencies</a></h2>
<p>This tutorial uses SOEM.
If you are using Windows, install <a href="https://npcap.com/">Npcap</a> in <strong>WinPcap API-compatible Mode</strong>.</p>
<h2 id="setup-devices"><a class="header" href="#setup-devices">Setup devices</a></h2>
<p>First, set up the devices.
Here, we assume that only one AUTD3 is used.
Connect the PC’s Ethernet port and the AUTD3 device’s EtherCAT In (<a href="Users_Manual/concept.html">Concept</a>) with an Ethernet cable.
Next, connect the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">24</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">V</span></span></span></span></span> power supply.</p>
<h3 id="firmware-update"><a class="header" href="#firmware-update">Firmware update</a></h3>
<p>If the firmware is old, normal operation is not guaranteed.
The firmware version in this document is assumed to be v4.0.x.</p>
<p>To update the firmware, you need a Windows 10/11 64bit PC with <a href="https://www.xilinx.com/products/design-tools/vivado.html">Vivado</a> and <a href="https://www.segger.com/downloads/jlink/">J-Link Software</a> installed.</p>
<blockquote>
<p>Note: If you only want to update the firmware, we strongly recommend using “Vivado Lab Edition”.
The “Vivado ML Edition” requires more than 60 GB of disk space to install, while the “Vivado Lab Edition” requires only about 6 GB.</p>
</blockquote>
<p>First, connect the AUTD3 device and the PC with <a href="https://www.xilinx.com/products/boards-and-kits/hw-usb-ii-g.html">XILINX Platform Cable</a> and <a href="https://www.segger.com/products/debug-probes/j-link/models/j-link-plus/">J-Link Plus</a> with <a href="https://www.segger-pocjapan.com/j-link-9-pin-cortex-m-adapter">J-Link 9-Pin Cortex-M Adapter</a>, and turn on the power of the AUTD3.</p>
<p>Then, run <code>firmware/autd_firmware_writer.ps1</code> in <a href="https://github.com/shinolab/autd3">SDK</a> on powershell.</p>
<h2 id="language-specific-tutorials"><a class="header" href="#language-specific-tutorials">Language-specific tutorials</a></h2>
<ul>
<li><a href="Users_Manual/./getting_started/rust.html">Rust</a></li>
<li><a href="Users_Manual/./getting_started/cpp.html">C++</a></li>
<li><a href="Users_Manual/./getting_started/cs.html">C#</a>
<ul>
<li><a href="Users_Manual/./getting_started/unity.html">Unity</a></li>
</ul>
</li>
<li><a href="Users_Manual/./getting_started/python.html">Python</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust-tutorial"><a class="header" href="#rust-tutorial">Rust tutorial</a></h1>
<p>First, make a new project and add <code>autd3</code> and <code>autd3-link-soem</code> libraries as dependencies.</p>
<pre><code class="language-shell">cargo new --bin autd3-sample
cd autd3-sample
cargo add autd3
cargo add autd3-link-soem
cargo add tokio --features full
</code></pre>
<p>Next, edit <code>src/main.rs</code> file as follows.
This is the source code for generating a focus with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span> AM modulation. </p>
<pre><code class="language-rust should_panic filename=main.rs edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_soem;
</span>use autd3::prelude::*;
use autd3_link_soem::SOEM;

#[tokio::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // Make a controller to control AUTD
    let mut autd = Controller::builder()
        // Configure the devices
        // The argument of AUTD3::new is position
        // Here, the device is placed at the origin
        .add_device(AUTD3::new(Vector3::zeros()))
        // Open controller with SOEM link
        // The callback specified by with_on_lost is called when SOEM loses the device
        .open_with(SOEM::builder().with_on_lost(|msg| {
            eprintln!(&quot;Unrecoverable error occurred: {msg}&quot;);
            std::process::exit(-1);
        })).await?;

    // Check firmware version
    // This code assumes that the version is v4.0.x
    autd.firmware_infos().await?.iter().for_each(|firm_info| {
        println!(&quot;{}&quot;, firm_info);
    });

    // Enable silencer
    // Note that this is enabled by default, so it is not actually necessary
    // To disable, send Silencer::disable()
    autd.send(Silencer::default()).await?;

    // A focus at 150mm directly above the center of the device
    let center = autd.geometry.center() + Vector3::new(0., 0., 150.0 * MILLIMETER);
    let g = Focus::new(center);

    // 150Hz sine wave modulation
    let m = Sine::new(150.);

    // Send data
    autd.send((m, g)).await?;

    println!(&quot;press enter to quit...&quot;);
    let mut _s = String::new();
    std::io::stdin().read_line(&amp;mut _s)?;

    // Close controller
    autd.close().await?;

    Ok(())
}</code></pre>
<p>Then, run the program.</p>
<pre><code class="language-shell">cargo run --release
</code></pre>
<h2 id="for-linux-macos-users"><a class="header" href="#for-linux-macos-users">For Linux, macOS users</a></h2>
<p>You may need to run with administrator privileges when using SOEM on Linux or macOS.</p>
<pre><code class="language-shell">cargo build --release &amp;&amp; sudo ./target/release/autd3_sample
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="c-tutorial"><a class="header" href="#c-tutorial">C++ tutorial</a></h1>
<h2 id="install-dependencies"><a class="header" href="#install-dependencies">Install dependencies</a></h2>
<p>In this tutorial, we use <a href="https://cmake.org/">CMake</a> to build the program.</p>
<h2 id="build-first-program"><a class="header" href="#build-first-program">Build first program</a></h2>
<p>First, open a terminal and prepare a directory for the sample.</p>
<pre><code class="language-shell">mkdir autd3-sample
cd autd3-sample
</code></pre>
<p>Then, make <code>CMakeLists.txt</code> and <code>main.cpp</code> files.</p>
<pre><code class="language-shell filename=">└─autd3-sample
        CMakeLists.txt
        main.cpp
</code></pre>
<p>Next, edit <code>CMakeLists.txt</code> as follows,</p>
<pre><code class="language-ignore filename=CMakeLists.txt">cmake_minimum_required(VERSION 3.21)

project(autd3-sample)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

if(${CMAKE_VERSION} VERSION_GREATER_EQUAL &quot;3.24.0&quot;) 
  cmake_policy(SET CMP0135 NEW)
endif()

include(FetchContent)
if(WIN32)
  FetchContent_Declare(
    autd3
    URL https://github.com/shinolab/autd3/releases/download/v18.0.1/autd3-v18.0.1-win-x64.zip
  )
elseif(APPLE)
  FetchContent_Declare(
    autd3
    URL https://github.com/shinolab/autd3/releases/download/v18.0.1/autd3-v18.0.1-macos-universal.tar.gz
  )
else()
  FetchContent_Declare(
    autd3
    URL https://github.com/shinolab/autd3/releases/download/v18.0.1/autd3-v18.0.1-linux-x64.tar.gz
  )
endif()
set(USE_SYSTEM_EIGEN OFF)
FetchContent_MakeAvailable(autd3)

add_executable(main main.cpp)

autd3_target_link_library(main PRIVATE)

if (CMAKE_GENERATOR MATCHES &quot;Visual Studio&quot;)
    set_property(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT main)
endif()
</code></pre>
<p>And, edit <code>main.cpp</code> as follows.
This is the source code for generating a focus with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span> AM modulation. </p>
<pre><code class="language-cpp filename=main.cpp">#include &lt;iostream&gt;

#include &quot;autd3.hpp&quot;
#include &quot;autd3/link/soem.hpp&quot;

void on_lost(const char* msg) {
  std::cerr &lt;&lt; &quot;Link is lost\n&quot;;
  std::cerr &lt;&lt; msg;
  exit(-1);
}

int main() try {
  // create and open controller
  auto autd =
      autd3::ControllerBuilder()
          // The  argument is the position.
          // The position is the origin of the device in the global coordinate
          // system you set.
          .add_device(autd3::AUTD3(autd3::Vector3::Zero()))
          .open_with_async(autd3::link::SOEM::builder().with_on_lost(&amp;on_lost))
          .get();

  // check firmware version
  const auto firm_infos = autd.firmware_infos_async().get();
  std::copy(firm_infos.begin(), firm_infos.end(),
            std::ostream_iterator&lt;autd3::FirmwareInfo&gt;(std::cout, &quot;\n&quot;));

  // Silencer is used to quiet down the transducers' noise by passing the
  // phase/amplitude parameters through a low-pass filter.
  autd3::Silencer silencer;
  autd.send_async(silencer).get();

  // focus is 150.0 mm above array center
  const autd3::Vector3 focus =
      autd.geometry().center() + autd3::Vector3(0.0, 0.0, 150.0);
  autd3::gain::Focus g(focus);

  // Amplitude Modulation of 150 Hz sine wave
  autd3::modulation::Sine m(150);

  // send data
  autd.send_async(m, g).get();

  std::cout &lt;&lt; &quot;press enter to finish...&quot; &lt;&lt; std::endl;
  std::cin.ignore();

  // close controller
  (void)autd.close_async().get();

  return 0;
} catch (std::exception&amp; ex) {
  std::cerr &lt;&lt; ex.what() &lt;&lt; std::endl;
}
</code></pre>
<p>Then, build with CMake.</p>
<pre><code class="language-shell">mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build . --config Release
</code></pre>
<p>Finally, run the program.</p>
<pre><code class="language-shell filename=Windows">.\Release\main.exe
</code></pre>
<pre><code class="language-shell filename=Linux/macOS">sudo ./main
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="c-tutorial-1"><a class="header" href="#c-tutorial-1">C# tutorial</a></h1>
<p>First, open a terminal and prepare a directory for the sample.
The, install AUTD3Sharp library.</p>
<pre><code class="language-shell">dotnet new console --name autd3-sample
cd autd3-sample
dotnet add package AUTD3Sharp
</code></pre>
<p>Next, make <code>Program.cs</code> file.
This is the source code for generating a focus with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span> AM modulation. </p>
<pre><code class="language-csharp filename=Program.cs">﻿using AUTD3Sharp;
using AUTD3Sharp.Utils;
using AUTD3Sharp.Link;
using AUTD3Sharp.Gain;
using AUTD3Sharp.Modulation;

var onLost = new SOEM.OnErrCallbackDelegate((string msg) =&gt;
{
    Console.WriteLine($&quot;Unrecoverable error occurred: {msg}&quot;);
    Environment.Exit(-1);
});

using var autd = await new ControllerBuilder()
        .AddDevice(new AUTD3(Vector3d.zero))
        .OpenWithAsync(SOEM.Builder().WithOnLost(onLost));

var firmList = await autd.FirmwareInfoListAsync();
foreach (var firm in firmList)
    Console.WriteLine(firm);

await autd.SendAsync(new Silencer());

var g = new Focus(autd.Geometry.Center + new Vector3d(0, 0, 150));
var m = new Sine(150);
await autd.SendAsync(m, g);

Console.ReadKey(true);

await autd.CloseAsync();
</code></pre>
<p>Then, run the program.</p>
<pre><code class="language-shell">dotnet run -c:Release
</code></pre>
<h2 id="for-linux-macos-users-1"><a class="header" href="#for-linux-macos-users-1">For Linux, macOS users</a></h2>
<p>You may need to run with administrator privileges when using SOEM on Linux or macOS.</p>
<pre><code class="language-shell">sudo dotnet run -c:Release
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="unity-tutorial"><a class="header" href="#unity-tutorial">Unity tutorial</a></h1>
<p>Unity library use left-handed coordinate system and meter as a basic unit of length.
Also, it uses <code>float</code> instead of <code>double</code> for floating point numbers.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>You can install the library via Unity Package Manager.</p>
<ol>
<li>From the menu bar, select “Edit” &gt; “Project settings” &gt; “Package Manager”.</li>
<li>Add the following “Scoped registory”.
<ul>
<li>Name    : shinolab</li>
<li>URL     : https://registry.npmjs.com</li>
<li>Scope(s): com.shinolab</li>
</ul>
</li>
<li>From the menu bar, select “Window” &gt; “Package Manager”.</li>
<li>Select “My Registries” from the drop-down menu in the upper left corner.</li>
<li>Install the following package depending on your OS.
<ul>
<li>For Windows: <code>autd3-unity</code></li>
<li>For macOS: <code>autd3-unity-mac</code></li>
<li>For Linux: <code>autd3-unity-linux</code></li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="python-tutorial"><a class="header" href="#python-tutorial">Python tutorial</a></h1>
<p>First, install <code>pyautd3</code> library.</p>
<pre><code class="language-shell">pip install pyautd3
</code></pre>
<p>Next, make <code>main.py</code> file as follows.
This is the source code for generating a focus with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span> AM modulation. </p>
<pre><code class="language-python filename=main.py">import asyncio
import ctypes
import os
from typing import NoReturn

import numpy as np
from pyautd3 import AUTD3, Controller, Silencer
from pyautd3.gain import Focus
from pyautd3.link.soem import SOEM, OnErrFunc
from pyautd3.modulation import Sine


def on_lost(msg: ctypes.c_char_p) -&gt; NoReturn:
    print(msg.decode(&quot;utf-8&quot;), end=&quot;&quot;)
    os._exit(-1)


def on_err(msg: ctypes.c_char_p) -&gt; None:
    print(msg.decode(&quot;utf-8&quot;), end=&quot;&quot;)


async def main() -&gt; None:
    on_lost_func = OnErrFunc(on_lost)
    on_err_func = OnErrFunc(on_err)

    with await (
        Controller.builder()
        .add_device(AUTD3([0.0, 0.0, 0.0]))
        .open_with_async(
            SOEM.builder().with_on_lost(on_lost_func).with_on_err(on_err_func)
        )
    ) as autd:
        firm_info_list = await autd.firmware_info_list_async()
        print(&quot;\n&quot;.join([f&quot;[{i}]: {firm}&quot; for i, firm in enumerate(firm_info_list)]))

        await autd.send_async(Silencer())

        g = Focus(autd.geometry.center + np.array([0.0, 0.0, 150.0]))
        m = Sine(150)
        await autd.send_async(m, g)

        _ = input()

        await autd.close_async()


if __name__ == &quot;__main__&quot;:
    asyncio.run(main())
</code></pre>
<p>Then, run the program.</p>
<pre><code class="language-shell">python main.py
</code></pre>
<h2 id="for-linux-users"><a class="header" href="#for-linux-users">For linux users</a></h2>
<p>You may need to run with administrator privileges when using SOEM on Linux.</p>
<pre><code class="language-shell">sudo setcap cap_net_raw,cap_net_admin=eip &lt;your python path&gt;
python main.py
</code></pre>
<h2 id="for-macos-users"><a class="header" href="#for-macos-users">For macOS users</a></h2>
<p>You may need to run with administrator privileges when using SOEM on macOS.</p>
<pre><code class="language-shell">sudo chmod +r /dev/bpf*
python main.py
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="versioning"><a class="header" href="#versioning">Versioning</a></h1>
<p>AUTD3 follows <a href="https://semver.org/">Semantic Versioning</a> from v8.2.0.</p>
<h2 id="firmware-version"><a class="header" href="#firmware-version">Firmware version</a></h2>
<p>The firmware version also follows semantic versioning.</p>
<p>However, the firmware version is different from the software version.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="geometry"><a class="header" href="#geometry">Geometry</a></h1>
<p>In this chapter, we explain about <code>Geometry</code>.
<code>Geometry</code> manages how AUTD3 devices are placed in the real world.</p>
<ul>
<li><a href="Users_Manual/geometry.html#connect-multiple-devices">Connect multiple devices</a></li>
<li><a href="Users_Manual/geometry.html#devicetransducer-index">Device/Transducer index</a></li>
<li><a href="Users_Manual/geometry.html#geometry-api">Geometry API</a>
<ul>
<li><a href="Users_Manual/geometry.html#device-access">Device access</a></li>
</ul>
</li>
<li><a href="Users_Manual/geometry.html#device-api">Device API</a>
<ul>
<li><a href="Users_Manual/geometry.html#transducer-access">Transducer access</a></li>
</ul>
</li>
<li><a href="Users_Manual/geometry.html#transducer-api">Transducer API</a></li>
</ul>
<h2 id="connect-multiple-devices"><a class="header" href="#connect-multiple-devices">Connect multiple devices</a></h2>
<p>AUTD3 devices can be connected to each other via the daisy chain.
SDK is designed to be used transparently even if multiple devices are connected.</p>
<p>To use multiple devices, connect the PC and the EtherCAT In of the first device with an Ethernet cable, and connect the EtherCAT Out of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>-th device and the EtherCAT In of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>-th device with an Ethernet cable (See <a href="Users_Manual/concept.html">Concept</a>).</p>
<p>In SDK, you must call <code>add_device</code> function <strong>in the order of the connected devices</strong> when using multiple devices.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/hor_left_ori_left_1.png"/>
</figure>
<p>For example, suppose you have two devices as shown in the figure above.
The left device is the first device, and the right device is the second device.
Then, the code is as follows.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = 
</span>Controller::builder()
    .add_device(AUTD3::new(Vector3::zeros()))
    .add_device(AUTD3::new(Vector3::new(AUTD3::DEVICE_WIDTH, 0., 0.)))
<span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

autd3::ControllerBuilder()
    .add_device(autd3::AUTD3(autd3::Vector3::Zero()))
    .add_device(autd3::AUTD3(autd3::Vector3(autd3::AUTD3::DEVICE_WIDTH, 0, 0)))
</code></pre>
<pre><code class="language-cs">new ControllerBuilder()
   .AddDevice(new AUTD3(Vector3d.zero))
   .AddDevice(new AUTD3(new Vector3d(AUTD3.DeviceWidth, 0, 0)))
</code></pre>
<pre><code class="language-python">from pyautd3 import AUTD3, Controller

Controller.builder()\
    .add_device(AUTD3([0.0, 0.0, 0.0]))\
    .add_device(AUTD3([AUTD3.device_width(), 0.0, 0.0]))
</code></pre>
<p>Here, the first argument of the <code>AUTD3</code> constructor is the position, and the second argument is the rotation.
The rotation is specified by ZYZ Euler angles or quaternions.
Also, <code>AUTD3::DEVICE_WIDTH</code> is the width of the device (including the outline of the board).
In this example, no rotation is performed, so the second argument can be zero.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/hor_right_ori_left_1.png"/>
</figure>
<p>And, for example, suppose you have two devices as shown in the figure above, where the global origin is set to the left device.
Then, the code is as follows.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = 
</span>Controller::builder()
    .add_device(AUTD3::new(Vector3::new(-AUTD3::DEVICE_WIDTH, 0., 0.)))
    .add_device(AUTD3::new(Vector3::zeros()))
<span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

autd3::ControllerBuilder()
    .add_device(autd3::AUTD3(autd3::Vector3(-autd3::AUTD3::DEVICE_WIDTH, 0, 0)))
    .add_device(autd3::AUTD3(autd3::Vector3::Zero()))
</code></pre>
<pre><code class="language-cs">new ControllerBuilder()
   .AddDevice(new AUTD3(new Vector3d(-AUTD3.DeviceWidth, 0, 0)))
   .AddDevice(new AUTD3(Vector3d.zero))
</code></pre>
<pre><code class="language-python">from pyautd3 import AUTD3, Controller

Controller.builder()\
    .add_device(AUTD3([-AUTD3.device_width(), 0.0, 0.0]))\
    .add_device(AUTD3([0.0, 0.0, 0.0]))
</code></pre>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/vert.png"/>
</figure>
<p>Furthermore, for example, suppose you have two devices as shown in the figure above, where the global origin is set to the lower device.
Then, the code is as follows.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let autd = Controller::builder()
    .add_device(AUTD3::new(Vector3::zeros()))
    .add_device(
        AUTD3::new(Vector3::new(0., 0., AUTD3::DEVICE_WIDTH))
            .with_rotation(EulerAngle::ZYZ(0. * Rad, PI/2.0 * Rad, 0. * Rad)))
<span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

autd3::ControllerBuilder()
    .add_device(autd3::AUTD3(autd3::Vector3::Zero()))
    .add_device(autd3::AUTD3(autd3::Vector3(autd3::AUTD3::DEVICE_WIDTH, 0, 0))
                    .with_rotation(autd3::EulerAngles::from_zyz(
                        0 * rad, autd3::pi / 2 * rad, 0 * rad)))
</code></pre>
<pre><code class="language-cs">using static AUTD3Sharp.Angle.Units;

new ControllerBuilder()
   .AddDevice(new AUTD3(Vector3d.zero))
   .AddDevice(
      new AUTD3(new Vector3d(AUTD3.DeviceWidth, 0, 0))
         .WithRotation(EulerAngles.FromZYZ(0 * Rad, AUTD3.Pi / 2 * Rad, 0 * Rad)))
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3 import AUTD3, Controller
from pyautd3.geometry import EulerAngles, rad

Controller.builder()\
    .add_device(AUTD3([0.0, 0.0, 0.0]))\
    .add_device(
        AUTD3([AUTD3.device_width(), 0.0, 0.0]).with_rotation(
            EulerAngles.from_zyz(0 * rad, np.pi / 2 * rad, 0 * rad)))
</code></pre>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/hor_right_ori_right_1.png"/>
</figure>
<h2 id="devicetransducer-index"><a class="header" href="#devicetransducer-index">Device/Transducer index</a></h2>
<p>Devices are assigned indices starting from 0 in the order in which they are connected to the PC.</p>
<p>Also, each device has 249 transducers, and local indices are assigned (<a href="Users_Manual/./concept.html">see the concept</a> for the surface photo of AUTD).</p>
<h2 id="geometry-api"><a class="header" href="#geometry-api">Geometry API</a></h2>
<ul>
<li><code>num_devices</code>: Get the number of devices</li>
<li><code>num_transducers</code>: Get the number of all transducers</li>
<li><code>center</code>: Get the center of all transducers</li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span>let num_dev = autd.geometry.num_devices();
let num_tr = autd.geometry.num_transducers();
let center = autd.geometry.center();
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto num_dev = autd.geometry().num_devices();
const auto num_tr = autd.geometry().num_transducers();
const autd3::Vector3 center = autd.geometry().center();
</code></pre>
<pre><code class="language-cs">var numDevices = autd.Geometry.NumDevices;
var numTransducers = autd.Geometry.NumTransducers;
var center = autd.Geometry.Center;
</code></pre>
<pre><code class="language-python">num_devices = autd.geometry.num_devices
num_transducers = autd.geometry.num_transducers
center = autd.geometry.center
</code></pre>
<h3 id="device-access"><a class="header" href="#device-access">Device access</a></h3>
<p><code>Geometry</code> is a container of <code>Device</code>.</p>
<p>To access <code>Device</code>, use indexer.
Or, you can use an iterator.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span>let dev = &amp;autd.geometry[0];
for dev in &amp;autd.geometry {
    // do something
}
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">auto dev = autd.geometry()[0];
for (auto&amp; dev : autd.geometry()) {
  // do something
}
</code></pre>
<pre><code class="language-cs">var dev = autd.Geometry[0];
foreach (var dev in autd.Geometry)
{
  // do something
}
</code></pre>
<pre><code class="language-python">dev = autd.geometry[0]
for dev in autd.geometry:
    pass
</code></pre>
<h2 id="device-api"><a class="header" href="#device-api">Device API</a></h2>
<ul>
<li><code>idx</code>: Index of the device</li>
<li><code>enable</code>: Enable flag. If it is off, the data of the device will not be updated.
<ul>
<li>Note that this only controls whether the data is updated or not, and does not stop the output.</li>
</ul>
</li>
<li><code>sound_speed</code>: Get/set the speed of sound. The unit is mm/s.</li>
<li><code>set_sound_speed_from_temp</code>: Set the sound speed from the temperature. The unit of the temperature is Celsius. The default sound speed is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">340</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm/s</span></span></span></span></span>, which corresponds to the sound speed of air at about 15 degrees Celsius. Note that there is a function with the same name in <code>Geometry</code>, and you can set the sound speed from the temperature for all devices by using it.</li>
<li><code>attenuation</code>: Get/set the attenuation coefficient. The unit is Np/mm.</li>
<li><code>translate</code>: Apply translation</li>
<li><code>rotate</code>: Apply rotation</li>
<li><code>affine</code>: Apply affine transformation (translation/rotation)</li>
<li><code>force_fan</code>: flag to force the fan to start in Auto mode.
<ul>
<li>AUTD3 device has a fan, and it has three fan modes: Auto, Off, and On. In Auto mode, the temperature monitoring IC monitors the temperature of the IC, and when it exceeds a certain temperature, the fan starts automatically. In Off mode, the fan is always off, and in On mode, the fan is always on. The fan mode is switched by the jumper switch next to the fan. As shown in the figure below, the fan side is shorted to switch to Auto, the center is Off, and the right is On.<figure>
  <img src="Users_Manual/../fig/Users_Manual/fan.jpg"/>
<figcaption>Jumper switch to specify fan mode</figcaption>
</figure>
</li>
<li><code>force_fan</code> flag is a flag to force the fan to start in Auto mode.</li>
<li>The flag is actually updated when some data is sent. If you want to update only the flag, send <code>UpdateFlags</code>.</li>
</ul>
</li>
<li><code>reads_fpga_info</code>: flag to read the FPGA status. See <a href="Users_Manual/./controller.html#fpga_info">Controller/fpga_info</a> for details.</li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span>let mut dev = &amp;mut autd.geometry[0];
let idx = dev.idx();
dev.enable = false;
dev.sound_speed = 340e3;
dev.set_sound_speed_from_temp(15.);
dev.attenuation = 0.;
let t = Vector3::new(1., 0., 0.);
let r = UnitQuaternion::from_quaternion(Quaternion::new(1., 0., 0., 0.));
dev.translate(t);
dev.rotate(r);
dev.affine(t, r);
dev.force_fan = true;
dev.reads_fpga_info = true;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">auto dev = autd.geometry()[0];
const auto idx = dev.idx();
const auto enable = dev.enable();
dev.set_enable(false);
const auto sound_speed = dev.sound_speed();
dev.set_sound_speed(340e3);
dev.set_sound_speed_from_temp(15.);
const auto attenuation = dev.attenuation();
dev.set_attenuation(0);
const auto t = autd3::Vector3(1., 0., 0.);
const auto r = autd3::Quaternion(1., 0., 0., 0.);
dev.translate(t);
dev.rotate(r);
dev.affine(t, r);
dev.force_fan(true);
dev.reads_fpga_info(true);
</code></pre>
<pre><code class="language-cs">var dev = autd.Geometry[0];
var idx = dev.Idx;
dev.Enable = false;
dev.SoundSpeed = 340e3;
dev.SetSoundSpeedFromTemp(15);
dev.Attenuation = 0;
var t = new Vector3d(1, 0, 0);
var r = new Quaterniond(0, 0, 0, 1);
dev.Translate(t);
dev.Rotate(r);
dev.Affine(t, r);
dev.ForceFan = true;
dev.ReadsFPGAInfo = true;
</code></pre>
<pre><code class="language-python">dev = autd.geometry[0]
idx = dev.idx
dev.enable = False
dev.sound_speed = 340e3
dev.set_sound_speed_from_temp(15.0)
attenuation = dev.attenuation = 0
t = np.array([1.0, 0.0, 0.0])
r = np.array([1.0, 0.0, 0.0, 0.0])
dev.translate(t)
dev.rotate(r)
dev.affine(t, r)
dev.force_fan = True
dev.reads_fpga_info = True
</code></pre>
<h3 id="transducer-access"><a class="header" href="#transducer-access">Transducer access</a></h3>
<p><code>Device</code> is a container of <code>Transducer</code>, and <code>Transducer</code> contains information of each transducer.</p>
<p>To access <code>Transducer</code>, use the indexer.
Or, you can use an iterator.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span>let tr = &amp;autd.geometry[0][0];
for tr in &amp;autd.geometry[0] {
    // do something
}
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">auto tr = autd.geometry()[0][0];
for (auto&amp; tr : autd.geometry()[0]) {
  // do something
}
</code></pre>
<pre><code class="language-cs">var tr = autd.Geometry[0][0];
foreach (var tr in autd.Geometry[0])
{
  // do something
}
</code></pre>
<pre><code class="language-python">tr = autd.geometry[0][0]
for tr in autd.geometry[0]:
    pass
</code></pre>
<h2 id="transducer-api"><a class="header" href="#transducer-api">Transducer API</a></h2>
<p>Following methods are available for <code>Transducer</code>.</p>
<ul>
<li><code>idx</code>: Get the local index of the transducer.</li>
<li><code>position</code>: Get the position of the transducer.</li>
<li><code>rotation</code>: Get the rotation of the transducer. The rotation is represented by a quaternion.</li>
<li><code>x_direction</code>: Get the x direction vector of the transducer.</li>
<li><code>y_direction</code>: Get the y direction vector of the transducer.</li>
<li><code>z_direction</code>: Get the z direction vector of the transducer.</li>
<li><code>wavelength</code>: Get the wavelength of the transducer. You need to pass the sound speed as an argument.</li>
<li><code>wavenumber</code>: Get the wavenumber of the transducer. You need to pass the sound speed as an argument.</li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">   .open_with(autd3::link::Nop::builder()).await?;
</span>let tr = &amp;autd.geometry[0][0];
let idx = tr.idx();
let position = tr.position();
let rotation = tr.rotation();
let x_dir = tr.x_direction();
let y_dir = tr.y_direction();
let z_dir = tr.z_direction();

let sound_speed = autd.geometry[0].sound_speed;
let wavelen = tr.wavelength(sound_speed);
let wavenum = tr.wavenumber(sound_speed);
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto tr = autd.geometry()[0][0];
const auto idx = tr.idx();
const autd3::Vector3 position = tr.position();
const auto rotation = tr.rotation();
const auto x_dir = tr.x_direction();
const auto y_dir = tr.y_direction();
const auto z_dir = tr.z_direction();

const auto sound_speed = autd.geometry()[0].sound_speed();
const auto wavelen = tr.wavelength(sound_speed);
const auto wavenum = tr.wavenumber(sound_speed);
</code></pre>
<pre><code class="language-cs">var tr = autd.Geometry[0][0];
var trIdx = tr.Idx;
var position = tr.Position;
var rotation = tr.Rotation;
var xDir = tr.XDirection;
var yDir = tr.YDirection;
var zDir = tr.ZDirection;

var soundSpeed = autd.Geometry[0].SoundSpeed;
var wavelen = tr.Wavelength(soundSpeed);
var wavenum = tr.Wavenumber(soundSpeed);
</code></pre>
<pre><code class="language-python">tr = autd.geometry[0][0]
idx = tr.idx
position = tr.position
rotation = tr.rotation
x_dir = tr.x_direction
y_dir = tr.y_direction
z_dir = tr.z_direction

sound_speed = autd.geometry[0].sound_speed
wavelen = tr.wavelength(sound_speed)
wavenum = tr.wavenumber(sound_speed)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="link"><a class="header" href="#link">Link</a></h1>
<p>Link is an interface to AUTD3 devices.
You need to choose one of the following.</p>
<ul>
<li><a href="Users_Manual/./link/twincat.html">TwinCAT/RemoteTwinCAT</a></li>
<li><a href="Users_Manual/./link/soem.html">SOEM/RemoteSOEM</a></li>
<li><a href="Users_Manual/./link/simulator.html">Simulator</a></li>
</ul>
<h2 id="link-options"><a class="header" href="#link-options">Link options</a></h2>
<h3 id="timeout"><a class="header" href="#timeout">Timeout</a></h3>
<p>Set the default timeout with <code>with_timeout</code>.</p>
<ul>
<li>The details of the timeout are described in <a href="Users_Manual/./controller.html#timeout">Controller#send#Timeout</a></li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate autd3_link_soem;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">use autd3_link_soem::SOEM;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let link = SOEM::builder().with_timeout(std::time::Duration::from_millis(20));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/soem.hpp&quot;

autd3::link::SOEM::builder().with_timeout(std::chrono::milliseconds(20));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Link;

SOEM.Builder().WithTimeout(TimeSpan.FromMilliseconds(20))
</code></pre>
<pre><code class="language-python">from datetime import timedelta

from pyautd3.link.soem import SOEM

SOEM.builder().with_timeout(timedelta(milliseconds=20))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="twincat"><a class="header" href="#twincat">TwinCAT</a></h1>
<p>TwinCAT is a software that enables EtherCAT communication on Windows.
TwinCAT is the only official way to use EtherCAT on Windows.
TwinCAT is a very special software that supports only Windows and forcibly real-timeizes Windows.</p>
<p>You have to use a specific network controller to use TwinCAT.
Please see <a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tc3_overview/9309844363.html&amp;id=">List of supported network controllers</a>.</p>
<blockquote>
<p>Note: Alternatively, after installing TwinCAT, you can check the Vendor ID and Device ID of the corresponding device in <code>C:/TwinCAT/3.1/Driver/System/TcI8254x.inf</code>, and check it against “Device Manager” → “Ethernet Adapter” → “Property” → “Details” → “Hardware ID” to confirm.</p>
</blockquote>
<p>The NIC other than the above may work, but in that case, normal operation and real-time performance are not guaranteed.</p>
<ul>
<li><a href="Users_Manual/link/twincat.html#twincat-installation">TwinCAT installation</a></li>
<li><a href="Users_Manual/link/twincat.html#autd-server">AUTD Server</a>
<ul>
<li><a href="Users_Manual/link/twincat.html#config-file-and-driver-installation">Config file and driver installation</a></li>
<li><a href="Users_Manual/link/twincat.html#license">License</a></li>
<li><a href="Users_Manual/link/twincat.html#run-autd-server">Run AUTD Server</a></li>
</ul>
</li>
<li><a href="Users_Manual/link/twincat.html#twincat-link-api">TwinCAT link API</a>
<ul>
<li><a href="Users_Manual/link/twincat.html#constructor">Constructor</a></li>
</ul>
</li>
<li><a href="Users_Manual/link/twincat.html#troubleshooting">Troubleshooting</a></li>
<li><a href="Users_Manual/link/twincat.html#remotetwincat">RemoteTwinCAT</a>
<ul>
<li><a href="Users_Manual/link/twincat.html#setup">Setup</a></li>
<li><a href="Users_Manual/link/twincat.html#remotetwincat-link-api">RemoteTwinCAT link API</a>
<ul>
<li><a href="Users_Manual/link/twincat.html#constructor-1">Constructor</a></li>
</ul>
</li>
<li><a href="Users_Manual/link/twincat.html#firewall">Firewall</a></li>
</ul>
</li>
</ul>
<h2 id="twincat-installation"><a class="header" href="#twincat-installation">TwinCAT installation</a></h2>
<p>TwinCAT can not coexist with Hyper-V or Virtual Machine Platform.
Therefore, it is necessary to disable these functions.
For example, start PowerShell with administrator privileges and type the following:</p>
<pre><code class="language-PowerShell">Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor
Disable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform
</code></pre>
<p>First, download TwinCAT XAE from the <a href="https://www.beckhoff.com/en-en/">official site</a>.
To download, you need to register (free).</p>
<p>After downloading, run the installer and follow the instructions.
At this time, <strong>check</strong> “TwinCAT XAE Shell install” and <strong>uncheck</strong> “Visual Studio Integration”.</p>
<p>After installation, restart the PC and run <code>C:/TwinCAT/3.1/System/win8settick.bat</code> as an administrator, and restart again.</p>
<h2 id="autd-server"><a class="header" href="#autd-server">AUTD Server</a></h2>
<p>To use TwinCAT Link, install <code>AUTD Server</code> first.
The AUTD server’s installer is distributed on <a href="https://github.com/shinolab/autd3/releases">GitHub Releases</a>.</p>
<p>When you run <code>AUTD Server</code>, the following screen will appear, so open the “TwinCAT” tab.</p>
<figure>
  <img src="Users_Manual/link/../../fig/Users_Manual/autdserver_twincat.jpg"/>
</figure>
<h3 id="config-file-and-driver-installation"><a class="header" href="#config-file-and-driver-installation">Config file and driver installation</a></h3>
<p>At the first time, you need to install configuration file and driver for EherCAT.</p>
<p>First click “Copy AUTD.xml” button.
If you see a message like “AUTD.xml is successfully copied”, it is successful.</p>
<p>Then, click “Open XAE shell” button“.
Open the upper menu of TwinCAT XAE Shell, select “TwinCAT” → “Show Realtime Ethernet Compatible Devices”, select the corresponding device in “Compatible devices”, and click “Install”.
If you see the installed device in “Installed and ready to use devices (realtime capable)”, it is successful.</p>
<p>Note: If “Compatible devices” is not displayed, the Ethernet device on that PC is not compatible with TwinCAT.
In that case, you can install the driver in “Incompatible devices”, but it is not guaranteed to work.</p>
<h3 id="license"><a class="header" href="#license">License</a></h3>
<p>In addition, the first time you run it, you will get a license error.
Open “Solution Explorer” → “SYSTEM” → “License” in XAE Shell, click “7 Days Trial License …”, and enter the characters displayed on the screen.
Note that the license is a 7-day trial license, but you can reissue it by doing the same thing again.
After issuing the license, close TwinCAT XAE Shell and run again.</p>
<h3 id="run-autd-server"><a class="header" href="#run-autd-server">Run AUTD Server</a></h3>
<p>Connect AUTD3 devices and PC, and power on the devices.
Then, click “Run” button on AUTD Server.
Here, let “Client IP address” be empty.</p>
<p>If you got a message like “AUTDs are found and added”, it is successful.</p>
<figure>
  <img src="Users_Manual/link/../../fig/Users_Manual/autdserver_twincat_run.jpg"/>
</figure>
<h2 id="twincat-link-api"><a class="header" href="#twincat-link-api">TwinCAT link API</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">Constructor</a></h3>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_twincat;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_link_twincat::TwinCAT;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">    .open_with(
</span>TwinCAT::builder()
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/twincat.hpp&quot;

autd3::link::TwinCAT::builder()
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Link;

TwinCAT.Builder()
</code></pre>
<pre><code class="language-python">from pyautd3.link.twincat import TwinCAT

TwinCAT.builder()
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<p>When using a large number of devices, the following error may occur.</p>
<figure>
  <img src="Users_Manual/link/../../fig/Users_Manual/tcerror.jpg"/>
  <figcaption>TwinCAT error when using 9 devices</figcaption>
</figure>
<p>In this case, increase the values of the <code>Sync0 cycle time</code> and <code>Send task cycle time</code> options of <code>AUTD Server</code> and run again.</p>
<p>The values should be as small as possible while no error occurs.</p>
<h1 id="remotetwincat"><a class="header" href="#remotetwincat">RemoteTwinCAT</a></h1>
<p>As mentioned above, AUTD3 and TwinCAT can only be used on Windows OS.
If you want to develop on a PC other than Windows, you can use <code>RemoteTwinCAT</code> link to remotely operate TwinCAT from Linux/macOS.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>You need to prepare two PCs to use RemoteTwinCAT.
In this case, one of the PCs must be able to use the above TwinCAT link.
This PC is called “server” here.
On the other hand, there are no particular restrictions on the PC on the development side, that is, the side using the SDK, and it just needs to be connected to the same LAN as the server.</p>
<p>First, connect the server and the AUTD device.
The LAN adapter used at this time must be a TwinCAT compatible adapter, just like the TwinCAT link.
Also, connect the server and the client on different LANs.
The LAN adapter here does not need to be TwinCAT compatible.
Then, check the IP of the LAN between the server and the client.
Here, for example, the server side is “172.16.99.104”, and the client side is “172.16.99.62”.</p>
<p>Next, start <code>AUTD Server</code> on the server.
At this time, specify the IP address of the client (in this example, <code>172.16.99.62</code>) with the <code>Client IP address</code> option.</p>
<figure>
  <img src="Users_Manual/link/../../fig/Users_Manual/autdserver_remotetwincat.jpg"/>
</figure>
<p>You can see “Server AmsNetId” and “Client AmsNetId” on the right panel.</p>
<h2 id="remotetwincat-link-api"><a class="header" href="#remotetwincat-link-api">RemoteTwinCAT link API</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">Constructor</a></h3>
<p>You must specify the “Server AmsNetId” in the constructor of <code>RemoteTwinCAT</code> link.</p>
<p>And, specify the “Client AmsNetId” in the <code>with_client_ams_net_id</code> method.
Also, specify the IP address of the server in the <code>with_server_ip</code> method.
These two values is optional, but it is recommended to specify them.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_twincat;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_link_twincat::RemoteTwinCAT;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">     .open_with(
</span>RemoteTwinCAT::builder(&quot;172.16.99.111.1.1&quot;)
            .with_server_ip(&quot;172.16.99.104&quot;)
            .with_client_ams_net_id(&quot;172.16.99.62.1.1&quot;)
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/twincat.hpp&quot;

autd3::link::RemoteTwinCAT::builder(&quot;172.16.99.111.1.1&quot;)
    .with_server_ip(&quot;172.16.99.104&quot;)
    .with_client_ams_net_id(&quot;172.16.99.62.1.1&quot;)
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Link;

RemoteTwinCAT.Builder(&quot;172.16.99.111.1.1&quot;)
        .WithServerIp(IPAddress.Parse(&quot;172.16.99.104&quot;))
        .WithClientAmsNetId(&quot;172.16.99.62.1.1&quot;)
</code></pre>
<pre><code class="language-python">from pyautd3.link.twincat import RemoteTwinCAT

RemoteTwinCAT.builder(&quot;172.16.99.111.1.1&quot;)\
    .with_server_ip(&quot;172.16.99.104&quot;)\
    .with_client_ams_net_id(&quot;172.16.99.62.1.1&quot;)
</code></pre>
<h2 id="firewall"><a class="header" href="#firewall">Firewall</a></h2>
<p>If you get a TCP-related error when using RemoteTwinCAT, the ADS protocol may be blocked by the firewall.
In that case, allow the connection of TCP/UDP port 48898 in the firewall settings.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="soem"><a class="header" href="#soem">SOEM</a></h1>
<p><a href="https://github.com/OpenEtherCATsociety/SOEM">SOEM</a> is an open source EtherCAT master library developed by volunteers.
Unlike TwinCAT, it runs on a regular Windows PC, so real-time performance is not guaranteed.
Therefore, it is recommended to use TwinCAT.
SOEM should be used only if there is no other choice or only during development.
On the other hand, SOEM is cross-platform and easy to install.</p>
<p>If you are using Windows, install <a href="https://nmap.org/npcap/">npcap</a> in <strong>WinPcap API compatible mode</strong>.
If you are using Linux/macOS, no special preparation is required.</p>
<blockquote>
<p>NOTE: If you are using <code>SOEM</code>, be aware that it takes about 10-20 seconds after opening <code>Controller</code> for the EtherCAT slaves to synchronize with each other.
This period is subject to individual differences and changes depending on the synchronization signal/transmission cycle.
During this period, the ultrasound synchronization between devices is not guaranteed.</p>
</blockquote>
<ul>
<li><a href="Users_Manual/link/soem.html#soem-link-api">SOEM link API</a></li>
<li><a href="Users_Manual/link/soem.html#remotesoem">RemoteSOEM</a>
<ul>
<li><a href="Users_Manual/link/soem.html#autd-server">AUTD Server</a></li>
<li><a href="Users_Manual/link/soem.html#remotesoem-link-api">RemoteSOEM link API</a></li>
<li><a href="Users_Manual/link/soem.html#soemautdserver">SOEMAUTDServer</a></li>
<li><a href="Users_Manual/link/soem.html#firewall">Firewall</a></li>
</ul>
</li>
</ul>
<h2 id="soem-link-api"><a class="header" href="#soem-link-api">SOEM link API</a></h2>
<p>Following options can be specified for SOEM link.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_soem;
</span>use autd3::prelude::*;
use autd3_link_soem::{SOEM, SyncMode};

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">           .open_with(
</span>SOEM::builder()
    .with_ifname(&quot;&quot;)
    .with_buf_size(32)
    .with_on_err(|msg| {
        eprintln!(&quot;Unrecoverable error occurred: {msg}&quot;);
    })
    .with_state_check_interval(std::time::Duration::from_millis(100))
    .with_on_lost(|msg| {
        eprintln!(&quot;Unrecoverable error occurred: {msg}&quot;);
        std::process::exit(-1);
    })
    .with_sync0_cycle(2)
    .with_send_cycle(2)
    .with_timer_strategy(TimerStrategy::BusyWait)
    .with_sync_mode(SyncMode::DC)
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/soem.hpp&quot;

[[noreturn]] void on_lost(const char* msg) {
  std::cerr &lt;&lt; &quot;Link is lost\n&quot; &lt;&lt; msg &lt;&lt; std::endl;
  exit(-1);
}

void on_err(const char* msg) { std::cerr &lt;&lt; &quot;Err: &quot; &lt;&lt; msg &lt;&lt; std::endl; }

autd3::link::SOEM::builder()
    .with_ifname(&quot;&quot;)
    .with_buf_size(32)
    .with_on_err(&amp;on_err)
    .with_state_check_interval(std::chrono::milliseconds(100))
    .with_on_lost(&amp;on_lost)
    .with_sync0_cycle(2)
    .with_send_cycle(2)
    .with_timer_strategy(autd3::TimerStrategy::BusyWait)
    .with_sync_mode(autd3::link::SyncMode::DC)
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Link;

var onLost = new SOEM.OnErrCallbackDelegate(msg =&gt;
{
    Console.WriteLine($&quot;Unrecoverable error occurred: {msg}&quot;);
    Environment.Exit(-1);
});
var onErr = new SOEM.OnErrCallbackDelegate(msg =&gt;
{
    Console.WriteLine($&quot;Err: {msg}&quot;);
});

SOEM.Builder()
    .WithIfname(&quot;&quot;)
    .WithBufSize(32)
    .WithOnErr(onErr)
    .WithStateCheckInterval(TimeSpan.FromMilliseconds(100))
    .WithOnLost(onLost)
    .WithSync0Cycle(2)
    .WithSendCycle(2)
    .WithTimerStrategy(TimerStrategy.BusyWait)
    .WithSyncMode(SyncMode.DC)
</code></pre>
<pre><code class="language-python">import ctypes
import os
from datetime import timedelta
from typing import NoReturn

from pyautd3 import TimerStrategy
from pyautd3.link.soem import SOEM, OnErrFunc, SyncMode


def on_lost(msg: ctypes.c_char_p) -&gt; NoReturn:
    print(msg.decode(&quot;utf-8&quot;), end=&quot;&quot;)
    os._exit(-1)


def on_err(msg: ctypes.c_char_p) -&gt; None:
    print(msg.decode(&quot;utf-8&quot;), end=&quot;&quot;)


on_lost_func = OnErrFunc(on_lost)
on_err_func = OnErrFunc(on_err)
SOEM.builder()\
        .with_ifname(&quot;&quot;)\
        .with_buf_size(32)\
        .with_on_err(on_err_func)\
        .with_state_check_interval(timedelta(milliseconds=100))\
        .with_on_lost(on_lost_func)\
        .with_sync0_cycle(2)\
        .with_send_cycle(2)\
        .with_timer_strategy(TimerStrategy.BusyWait)\
        .with_sync_mode(SyncMode.DC)
</code></pre>
<ul>
<li><code>ifname</code>: Network interface name. The default is blank, and if it is blank, the network interface to which the AUTD3 device is connected is automatically selected.</li>
<li><code>buf_size</code>: Send queue buffer size. Usually, you don’t need to change it.</li>
<li><code>on_err</code>: Callback when some error occurs. The callback function takes an error message as an argument.</li>
<li><code>state_check_interval</code>: Interval to check if there is an error. The default is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">100</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">ms</span></span></span></span></span></span>.</li>
<li><code>on_lost</code>: Callback when an unrecoverable error (e.g., cable is disconnected) occurs.<sup class="footnote-reference"><a href="#fn_soem_err">1</a></sup> The callback function takes an error message as an argument.</li>
<li><code>sync0_cycle</code>: Synchronization signal cycle. The default is 2 (unit is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">500</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">us</span></span></span></span></span></span>).</li>
<li><code>send_cycle</code>: Send cycle. The default is 2 (unit is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">500</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">us</span></span></span></span></span></span>).
<ul>
<li><code>SOEM</code> may become unstable when a large number of devices are connected<sup class="footnote-reference"><a href="#fn_soem">2</a></sup>. In this case, increase the values of <code>sync0_cycle</code> and <code>send_cycle</code>. These values should be as small as possible without causing errors. The default is 2, and the value depends on the number of devices connected. For example, if there are 9 devices, set the value to 3 or 4.</li>
</ul>
</li>
<li><code>timer_strategy</code>: Timer strategy. The default is <code>Sleep</code>.
<ul>
<li><code>Sleep</code>       : Use standard library sleep</li>
<li><code>BusyWait</code>    : Use busy wait. High resolution but high CPU load.</li>
<li><code>NativeTimer</code> : Use OS timer function
<ul>
<li>TimerQueueTimer on Windows, POSIX timer on linux, Grand Central Dispatch Timer on macOS</li>
</ul>
</li>
</ul>
</li>
<li><code>sync_mode</code>: Synchronization mode. See <a href="https://infosys.beckhoff.com/english.php?content=../content/1033/ethercatsystem/2469122443.html&amp;id=">Beckhoff’s explanation</a> for details.</li>
</ul>
<h1 id="remotesoem"><a class="header" href="#remotesoem">RemoteSOEM</a></h1>
<p>This link is used to separate the server PC running <code>SOEM</code> and the client PC running the user program.</p>
<p>To use <code>RemoteSOEM</code>, you need to prepare two PCs.
In this case, one PC must be able to use the <code>SOEM</code> link.
This PC is called the “server” here.
On the other hand, there are no particular restrictions on the PC on the development side that uses the SDK, and it is sufficient to be connected to the same LAN as the server.
This is called the “client” here.</p>
<p>First, connect the server and the AUTD device.
Then, connect the server and the client on different LANs<sup class="footnote-reference"><a href="#fn_remote_soem">3</a></sup>.
Then, check the IP of the LAN between the server and the client.
For example, suppose the server is “172.16.99.104”, and the client is “172.16.99.62”.</p>
<h2 id="autd-server-1"><a class="header" href="#autd-server-1">AUTD Server</a></h2>
<p>To use <code>RemoteSOEM</code>, install <code>AUTD Server</code> first.
The AUTD server’s installer is distributed on <a href="https://github.com/shinolab/autd3/releases">GitHub Releases</a>.</p>
<p>When you run <code>AUTD Server</code>, the following screen will appear, so open the “SOEM” tab.</p>
<figure>
  <img src="Users_Manual/link/../../fig/Users_Manual/autdserver_remotesoem.jpg"/>
</figure>
<p>Set port number and click “Run” button.</p>
<h2 id="remotesoem-link-api"><a class="header" href="#remotesoem-link-api">RemoteSOEM link API</a></h2>
<p><code>RemoteSOEM</code> constructor takes <server ip address:port> as an argument.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_soem;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_link_soem::RemoteSOEM;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">    .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">           .open_with(
</span>RemoteSOEM::builder(&quot;172.16.99.104:8080&quot;.parse()?)
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/soem.hpp&quot;

autd3::link::RemoteSOEM::builder(&quot;172.16.99.104:8080&quot;)
</code></pre>
<pre><code class="language-cs">using System.Net;
using AUTD3Sharp.Link;

RemoteSOEM.Builder(new IPEndPoint(IPAddress.Parse(&quot;172.16.99.104&quot;), 8080))
</code></pre>
<pre><code class="language-python">from pyautd3.link.soem import RemoteSOEM

RemoteSOEM.builder(&quot;172.16.99.104:8080&quot;)
</code></pre>
<h2 id="soemautdserver"><a class="header" href="#soemautdserver">SOEMAUTDServer</a></h2>
<p>You can set options for <code>SOEM</code> with the option argument of <code>SOEMAUTDServer</code>.
Please see <code>SOEMAUTDServer --help</code> for details.</p>
<h2 id="firewall-1"><a class="header" href="#firewall-1">Firewall</a></h2>
<p>If you get a TCP-related error when using <code>RemoteSOEM</code>, it may be blocked by the firewall.</p>
<div class="footnote-definition" id="fn_soem"><sup class="footnote-definition-label">2</sup>
<p>It is looser than TwinCAT, and sometimes it works normally.</p>
</div>
<div class="footnote-definition" id="fn_soem_err"><sup class="footnote-definition-label">1</sup>
<p>It is unrecoverable, so there is nothing you can do but terminate it immediately.</p>
</div>
<div class="footnote-definition" id="fn_remote_soem"><sup class="footnote-definition-label">3</sup>
<p>It can be used even with wireless LAN.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="simulator"><a class="header" href="#simulator">Simulator</a></h1>
<p>Simulator link is a link used when using <a href="Users_Manual/link/../../Simulator/simulator.html">AUTD simulator</a>.</p>
<p>Before using this link, you need to start AUTD simulator.</p>
<ul>
<li><a href="Users_Manual/link/simulator.html#simulator-link-api">Simulator link API</a>
<ul>
<li><a href="Users_Manual/link/simulator.html#contructor">Contructor</a></li>
<li><a href="Users_Manual/link/simulator.html#autd-simulator-server-ip-address">AUTD simulator server IP address</a></li>
<li><a href="Users_Manual/link/simulator.html#update-geometry">Update <code>Geometry</code></a></li>
</ul>
</li>
</ul>
<h2 id="simulator-link-api"><a class="header" href="#simulator-link-api">Simulator link API</a></h2>
<h3 id="contructor"><a class="header" href="#contructor">Contructor</a></h3>
<p>Simulator link’s constructor takes a port number of AUTD simulator.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_simulator;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_link_simulator::Simulator;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">            .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">            .open_with(
</span>Simulator::builder(8080)
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/simulator.hpp&quot;

autd3::link::Simulator::builder(8080)
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Link;

Simulator.Builder(8080)
</code></pre>
<pre><code class="language-python">from pyautd3.link.simulator import Simulator

Simulator.builder(8080)
</code></pre>
<h3 id="autd-simulator-server-ip-address"><a class="header" href="#autd-simulator-server-ip-address">AUTD simulator server IP address</a></h3>
<p>You can specify the IP address of the server running AUTD simulator with <code>with_server_ip</code>.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_simulator;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_link_simulator::Simulator;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let autd = Controller::builder()
</span><span class="boring">            .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">            .open_with(
</span>Simulator::builder(8080).with_server_ip(&quot;127.0.0.1&quot;.parse()?)
<span class="boring">).await?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/link/simulator.hpp&quot;

autd3::link::Simulator::builder(8080).with_server_ip(&quot;127.0.0.1&quot;)
</code></pre>
<pre><code class="language-cs">using System.Net;
using AUTD3Sharp.Link;

Simulator.Builder(8080).WithServerIp(IPAddress.Parse(&quot;127.0.0.1&quot;))
</code></pre>
<pre><code class="language-python">from pyautd3.link.simulator import Simulator

Simulator.builder(8080).with_server_ip(&quot;127.0.0.1&quot;)
</code></pre>
<p>The default server IP address is localhost.</p>
<h3 id="update-geometry"><a class="header" href="#update-geometry">Update <code>Geometry</code></a></h3>
<p>If you update <code>Geometry</code>, the geometry in the simulator side will not be updated automatically.
To update <code>Geometry</code>, use <code>update_geometry</code> function.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_link_simulator;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">use autd3_link_simulator::Simulator;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder()
</span><span class="boring">            .add_device(AUTD3::new(Vector3::zeros()))
</span><span class="boring">            .open_with(Simulator::builder(8080)).await?;
</span>autd.link.update_geometry(&amp;autd.geometry).await?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">autd.link.update_geometry_async(autd.geometry()).get();
</code></pre>
<pre><code class="language-cs">await autd.Link.UpdateGeometryAsync(autd.Geometry);
</code></pre>
<pre><code class="language-python">await autd.link.update_geometry_async(autd.geometry)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="gain"><a class="header" href="#gain">Gain</a></h1>
<p>AUTD can control the phase/amplitude of each transducer individually, which enables us to generate various sound fields.
<code>Gain</code> is a class to manage this, and the SDK provides some <code>Gain</code>s to generate various sound fields.</p>
<ul>
<li><a href="Users_Manual/./gain/null.html">Null</a></li>
<li><a href="Users_Manual/./gain/focus.html">Focus</a></li>
<li><a href="Users_Manual/./gain/bessel.html">Bessel</a></li>
<li><a href="Users_Manual/./gain/plane.html">Plane</a></li>
<li><a href="Users_Manual/./gain/uniform.html">Uniform</a></li>
<li><a href="Users_Manual/./gain/grouped.html">Group</a></li>
<li><a href="Users_Manual/./gain/holo.html">Holo</a></li>
<li><a href="Users_Manual/./gain/cache.html">Cache</a></li>
<li><a href="Users_Manual/./gain/transform.html">Transform</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="null"><a class="header" href="#null">Null</a></h1>
<p><code>Null</code> is a <code>Gain</code> with zero amplitude.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let g = autd3::gain::Null::new();
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto g = autd3::gain::Null();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain;

var g = new Null();
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Null

g = Null()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="focus"><a class="header" href="#focus">Focus</a></h1>
<p><code>Focus</code> generates a single focal point.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span>let g = autd3::gain::Focus::new(Vector3::new(x, y, z));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g = autd3::gain::Focus(autd3::Vector3(x, y, z));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Utils;
using AUTD3Sharp.Gain;

var g = new Focus(new Vector3d(x, y, z));
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Focus

g = Focus([x, y, z])
</code></pre>
<h2 id="set-intensity"><a class="header" href="#set-intensity">Set intensity</a></h2>
<p>You can change emission intensity by <code>with_intensity</code> method.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span>let g = autd3::gain::Focus::new(Vector3::new(x, y, z))
            .with_intensity(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g = autd3::gain::Focus(autd3::Vector3(x, y, z))
                   .with_intensity(autd3::EmitIntensity::maximum());
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Utils;
using AUTD3Sharp.Gain;

var g = new Focus(new Vector3d(x, y, z)).WithIntensity(EmitIntensity.Max);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.gain import Focus

g = Focus([x, y, z]).with_intensity(EmitIntensity.maximum())
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="bessel"><a class="header" href="#bessel">Bessel</a></h1>
<p><code>BesselBeam</code> generates a Bessel beam.
This <code>Gain</code> is based on the paper by Hasegawa et al <sup class="footnote-reference"><a href="#hasegawa2017">1</a></sup>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span><span class="boring">let nx = 0.;
</span><span class="boring">let ny = 0.;
</span><span class="boring">let nz = 0.;
</span><span class="boring">let theta = 0.;
</span>let g = autd3::gain::Bessel::new(
            Vector3::new(x, y, z), 
            Vector3::new(nx, ny, nz), 
            theta,
        );
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g = autd3::gain::Bessel(autd3::Vector3(x, y, z),
                                   autd3::Vector3(nx, ny, nz), theta);
</code></pre>
<pre><code class="language-cs">from pyautd3.gain import Bessel

g = Bessel([x, y, z], [nx, ny, nz], theta)
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Bessel

g = Bessel([x, y, z], [nx, ny, nz], theta)
</code></pre>
<p>The first argument of the constructor is the apex of the virtual cone producing the beam, the second argument is the direction of the beam, and the third argument is the angle between the plane perpendicular to the beam and the side of the virtual cone producing the beam (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the figure below).</p>
<figure>
  <img src="Users_Manual/gain/../../fig/Users_Manual/1.4985159.figures.online.f1.jpg"/>
  <figcaption>Bessel beam[^hasegawa2017]</figcaption>
</figure>
<h2 id="set-intensity-1"><a class="header" href="#set-intensity-1">Set intensity</a></h2>
<p>You can change emission intensity by <code>with_intensity</code> method.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span><span class="boring">let nx = 0.;
</span><span class="boring">let ny = 0.;
</span><span class="boring">let nz = 0.;
</span><span class="boring">let theta = 0.;
</span>let g = autd3::gain::Bessel::new(
            Vector3::new(x, y, z),
            Vector3::new(nx, ny, nz), 
            theta
        ).with_intensity(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g = autd3::gain::Bessel(autd3::Vector3(x, y, z),
                                   autd3::Vector3(nx, ny, nz), theta)
                   .with_intensity(autd3::EmitIntensity::maximum());
</code></pre>
<pre><code class="language-cs">from pyautd3 import EmitIntensity
from pyautd3.gain import Bessel

g = Bessel([x, y, z], [nx, ny, nz], theta).with_intensity(EmitIntensity.maximum())
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.gain import Bessel

g = Bessel([x, y, z], [nx, ny, nz], theta).with_intensity(EmitIntensity.maximum())
</code></pre>
<div class="footnote-definition" id="hasegawa2017"><sup class="footnote-definition-label">1</sup>
<p>Hasegawa, Keisuke, et al. “Electronically steerable ultrasound-driven long narrow air stream.” Applied Physics Letters 111.6 (2017): 064104.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="plane"><a class="header" href="#plane">Plane</a></h1>
<p><code>Plane</code> output a plane wave.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span><span class="boring">let nx = 0.;
</span><span class="boring">let ny = 0.;
</span><span class="boring">let nz = 0.;
</span><span class="boring">let theta = 0.;
</span>let g = autd3::gain::Plane::new(Vector3::new(nx, ny, nz));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto g = autd3::gain::Plane(autd3::Vector3(nx, ny, nz));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Utils;
using AUTD3Sharp.Gain;

var g = new Plane(new Vector3d(nx, ny, nz));
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Plane

g = Plane([nx, ny, nz])
</code></pre>
<p>Specify the direction of the plane wave in the constructor of <code>Plane</code>.</p>
<h2 id="set-intensity-2"><a class="header" href="#set-intensity-2">Set intensity</a></h2>
<p>You can change emission intensity by <code>with_intensity</code> method.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span><span class="boring">let nx = 0.;
</span><span class="boring">let ny = 0.;
</span><span class="boring">let nz = 0.;
</span><span class="boring">let theta = 0.;
</span>let g = autd3::gain::Plane::new(Vector3::new(nx, ny, nz)).with_intensity(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto g = autd3::gain::Plane(autd3::Vector3(nx, ny, nz))
             .with_intensity(autd3::EmitIntensity::maximum());
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Utils;
using AUTD3Sharp.Gain;

var g = new Plane(new Vector3d(nx, ny, nz)).WithIntensity(EmitIntensity.Max);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.gain import Plane

g = Plane([nx, ny, nz]).with_intensity(EmitIntensity.maximum())
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="uniform"><a class="header" href="#uniform">Uniform</a></h1>
<p><code>Uniform</code> set the same amplitude and phase to all transducers.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let g = autd3::gain::Uniform::new(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto g = autd3::gain::Uniform(autd3::EmitIntensity::maximum());
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Gain;

var g = new Uniform(EmitIntensity.Max);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.gain import Uniform

g = Uniform(EmitIntensity.maximum())
</code></pre>
<p>Specify the amplitude in the constructor of <code>Uniform</code>.</p>
<h2 id="set-phase"><a class="header" href="#set-phase">Set phase</a></h2>
<p><code>with_phase</code> method sets the phase.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let g = autd3::gain::Uniform::new(EmitIntensity::MAX).with_phase(Phase::new(0));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto g = autd3::gain::Uniform(autd3::EmitIntensity::maximum())
                   .with_phase(autd3::Phase(0));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain;

var g = new Uniform(EmitIntensity.Max).WithPhase(new Phase(0));
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity, Phase
from pyautd3.gain import Uniform

g = Uniform(EmitIntensity.maximum()).with_phase(Phase(0))
</code></pre>
<p>The default phase is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="group"><a class="header" href="#group">Group</a></h1>
<p><code>Group</code> is a <code>Gain</code> to use different <code>Gain</code> for each transducer.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span>let g = Group::new(|dev, tr| match tr.idx() {
                0..=100 =&gt; Some(&quot;null&quot;),
                101.. =&gt; Some(&quot;focus&quot;),
                _ =&gt; None,
            })
            .set(&quot;null&quot;, Null::new())
            .set(&quot;focus&quot;, Focus::new(Vector3::new(x, y, z)));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g =
    autd3::gain::Group(
        [](const autd3::Device&amp; dev,
           const autd3::Transducer&amp; tr) -&gt; std::optional&lt;const char*&gt; {
          if (tr.idx() &lt;= 100) return &quot;null&quot;;
          return &quot;focus&quot;;
        })
        .set(&quot;null&quot;, autd3::gain::Null())
        .set(&quot;focus&quot;, autd3::gain::Focus(autd3::Vector3(x, y, z)));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Utils;
using AUTD3Sharp.Gain;

var g = new Group((dev, tr) =&gt; tr.Idx &lt;= 100 ? &quot;null&quot; : &quot;focus&quot;)
          .Set(&quot;null&quot;, new Null())
          .Set(&quot;focus&quot;, new Focus(new Vector3d(x, y, z)));
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Focus, Group, Null

g = (
    Group(lambda _, tr: &quot;null&quot; if tr.idx &lt;= 100 else &quot;focus&quot;)
    .set_gain(&quot;null&quot;, Null())
    .set_gain(&quot;focus&quot;, Focus([x, y, z]))
)
</code></pre>
<p>In the above case, transducers whose local indices are less or equal than 100 produce <code>Null</code>, and the others produce <code>Focus</code>.</p>
<blockquote>
<p>NOTE:
In this sample, we use string as a key, but you can use any type that can be used as a key of HashMap.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="holo"><a class="header" href="#holo">Holo</a></h1>
<p>Holo is a <code>Gain</code> for generating multiple foci.
Several algorithms for generating multiple foci have been proposed, and the following algorithms are implemented in SDK.</p>
<ul>
<li><code>SDP</code> - Semi-definite programming, based on Inoue et al.<sup class="footnote-reference"><a href="#inoue2015">1</a></sup></li>
<li><code>Naive</code> - Linear synthesis of single-focus solutions</li>
<li><code>GS</code> - Gershberg-Saxon, based on Marzo et al.<sup class="footnote-reference"><a href="#marzo2019">2</a></sup></li>
<li><code>GSPAT</code> - Gershberg-Saxon for Phased Arrays of Transducers, based on Plasencia et al.<sup class="footnote-reference"><a href="#plasencia2020">3</a></sup></li>
<li><code>LM</code> - Levenberg-Marquardt, LM method proposed by Levenberg <sup class="footnote-reference"><a href="#levenberg1944">4</a></sup> and Marquardt <sup class="footnote-reference"><a href="#marquardt1963">5</a></sup> for optimization of nonlinear least-squares problems, implementation based on Madsen’s text<sup class="footnote-reference"><a href="#madsen2004">6</a></sup></li>
<li><code>Greedy</code> - Greedy algorithm and Brute-force search, based on Suzuki et al.<sup class="footnote-reference"><a href="#suzuki2021">7</a></sup></li>
</ul>
<p>You can select the backend for the calculation of the algorithm from the following.</p>
<ul>
<li><code>NalgebraBackend</code> - uses <a href="hthttps://nalgebra.org/">Nalgebra</a></li>
<li><code>CUDABackend</code> - uses CUDA, which runs on GPUs</li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate autd3_gain_holo;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_gain_holo::{LinAlgBackend, NalgebraBackend, GSPAT, Pascal};

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let x1 = 0.;
</span><span class="boring">let y1 = 0.;
</span><span class="boring">let z1 = 0.;
</span><span class="boring">let x2 = 0.;
</span><span class="boring">let y2 = 0.;
</span><span class="boring">let z2 = 0.;
</span>let backend = NalgebraBackend::new()?;
let g = GSPAT::new(backend)
      .add_focus(Vector3::new(x1, y1, z1), 5e3 * Pascal)
      .add_focus(Vector3::new(x2, y2, z2), 5e3 * Pascal);
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/gain/holo.hpp&quot;

using autd3::gain::holo::Pascal;
const auto backend = std::make_shared&lt;autd3::gain::holo::NalgebraBackend&gt;();
auto g = autd3::gain::holo::GSPAT(backend)
             .add_focus(autd3::Vector3(x1, y1, z1), 5e3 * Pascal)
             .add_focus(autd3::Vector3(x2, y2, z2), 5e3 * Pascal);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain.Holo;
using AUTD3Sharp.Utils;
using static AUTD3Sharp.Gain.Holo.Amplitude.Units;

var backend = new NalgebraBackend();
var g = new GSPAT&lt;NalgebraBackend&gt;(backend)
            .AddFocus(new Vector3d(x1, y1, z1), 5e3 * Pascal)
            .AddFocus(new Vector3d(x2, y2, z2), 5e3 * Pascal);
</code></pre>
<pre><code class="language-python">from pyautd3.gain.holo import GSPAT, NalgebraBackend, pascal

backend = NalgebraBackend()
g = (
    GSPAT(backend)
    .add_focus([x1, y1, z1], 5e3 * pascal)
    .add_focus([x2, y2, z2], 5e3 * pascal)
)
</code></pre>
<p>The constructor argument of each algorithm is <code>backend</code>.</p>
<p>The <code>add_focus</code> function specifies the position of each focus and the amplitude.</p>
<h2 id="amplitude-constraint"><a class="header" href="#amplitude-constraint">Amplitude constraint</a></h2>
<p>Each algorithm’s calculation result must be limited to the range that the transducer can output.
This can be controlled by <code>with_constraint</code>, and one of the following four must be specified.</p>
<ul>
<li>DontCare: Do nothing.</li>
<li>Normalize: Divide the amplitude of all transducers by the maximum amplitude and normalize it.</li>
<li>Uniform: Set the amplitude of all transducers to the specified value.</li>
<li>Clamp: Clamp the amplitude to the specified range.</li>
</ul>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate autd3_gain_holo;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3_gain_holo::{LinAlgBackend, NalgebraBackend, GSPAT, EmissionConstraint};

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let x1 = 0.;
</span><span class="boring">let y1 = 0.;
</span><span class="boring">let z1 = 0.;
</span><span class="boring">let x2 = 0.;
</span><span class="boring">let y2 = 0.;
</span><span class="boring">let z2 = 0.;
</span>let backend = NalgebraBackend::new()?;
let g = GSPAT::new(backend)
      .with_constraint(EmissionConstraint::Uniform(EmitIntensity::MAX));
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/gain/holo.hpp&quot;

const auto backend = std::make_shared&lt;autd3::gain::holo::NalgebraBackend&gt;();
auto g = autd3::gain::holo::GSPAT(backend).with_constraint(
    autd3::gain::holo::EmissionConstraint::uniform(
        autd3::EmitIntensity::maximum()));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain.Holo;

var backend = new NalgebraBackend();
var g = new GSPAT&lt;NalgebraBackend&gt;(backend).WithConstraint(new Uniform(EmitIntensity.Max));
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.gain.holo import GSPAT, EmissionConstraint, NalgebraBackend

backend = NalgebraBackend()
g = GSPAT(backend).with_constraint(EmissionConstraint.uniform(EmitIntensity.maximum()))
</code></pre>
<h2 id="optimization-parameters"><a class="header" href="#optimization-parameters">Optimization parameters</a></h2>
<p>Each algorithm has additional parameters.
These are all specified by <code>with_xxx</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate autd3_gain_holo;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">use autd3_gain_holo::{LinAlgBackend, NalgebraBackend, GSPAT, Pascal};
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let x1 = 0.;
</span><span class="boring">let y1 = 0.;
</span><span class="boring">let z1 = 0.;
</span><span class="boring">let x2 = 0.;
</span><span class="boring">let y2 = 0.;
</span><span class="boring">let z2 = 0.;
</span>let backend = NalgebraBackend::new()?;
let g = GSPAT::new(backend).with_repeat(100);
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/gain/holo.hpp&quot;

const auto backend = std::make_shared&lt;autd3::gain::holo::NalgebraBackend&gt;();
auto g = autd3::gain::holo::GSPAT(backend).with_repeat(100);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain.Holo;

var backend = new NalgebraBackend();
var g = new GSPAT&lt;NalgebraBackend&gt;(backend).WithRepeat(100);
</code></pre>
<pre><code class="language-python">from pyautd3.gain.holo import GSPAT, NalgebraBackend

backend = NalgebraBackend()
g = GSPAT(backend).with_repeat(100)
</code></pre>
<p>Please refar to each paper for more details.</p>
<div class="footnote-definition" id="inoue2015"><sup class="footnote-definition-label">1</sup>
<p>Inoue, Seki, Yasutoshi Makino, and Hiroyuki Shinoda. “Active touch perception produced by airborne ultrasonic haptic hologram.” 2015 IEEE World Haptics Conference (WHC). IEEE, 2015.</p>
</div>
<div class="footnote-definition" id="marzo2019"><sup class="footnote-definition-label">2</sup>
<p>Marzo, Asier, and Bruce W. Drinkwater. “Holographic acoustic tweezers.” Proceedings of the National Academy of Sciences 116.1 (2019): 84-89.</p>
</div>
<div class="footnote-definition" id="plasencia2020"><sup class="footnote-definition-label">3</sup>
<p>Plasencia, Diego Martinez, et al. “GS-PAT: high-speed multi-point sound-fields for phased arrays of transducers.” ACM Transactions on Graphics (TOG) 39.4 (2020): 138-1.</p>
</div>
<div class="footnote-definition" id="levenberg1944"><sup class="footnote-definition-label">4</sup>
<p>Levenberg, Kenneth. “A method for the solution of certain non-linear problems in least squares.” Quarterly of applied mathematics 2.2 (1944): 164-168.</p>
</div>
<div class="footnote-definition" id="marquardt1963"><sup class="footnote-definition-label">5</sup>
<p>Marquardt, Donald W. “An algorithm for least-squares estimation of nonlinear parameters.” Journal of the society for Industrial and Applied Mathematics 11.2 (1963): 431-441.</p>
</div>
<div class="footnote-definition" id="madsen2004"><sup class="footnote-definition-label">6</sup>
<p>Madsen, Kaj, Hans Bruun Nielsen, and Ole Tingleff. “Methods for non-linear least squares problems.” (2004).</p>
</div>
<div class="footnote-definition" id="suzuki2021"><sup class="footnote-definition-label">7</sup>
<p>Suzuki, Shun, et al. “Radiation Pressure Field Reconstruction for Ultrasound Midair Haptics by Greedy Algorithm with Brute-Force Search.” IEEE Transactions on Haptics (2021).</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="cache"><a class="header" href="#cache">Cache</a></h1>
<p>You can cache the calculation result of <code>Gain</code> by <code>with_cache</code> method.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let g = Null::new().with_cache();
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">const auto g = autd3::gain::Null().with_cache();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain;

var g = new Null().WithCache();
</code></pre>
<pre><code class="language-python">g = Null().with_cache()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="transform"><a class="header" href="#transform">Transform</a></h1>
<p>You can use <code>Transform</code> to apply some post-processing to <code>Gain</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span>use autd3::prelude::*;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let g = Uniform::new(EmitIntensity::MAX).with_transform(|dev, tr, d| Drive {
    intensity: EmitIntensity::new(d.intensity.value() / 2),
    phase: Phase::from_rad(d.phase.radian() + PI),
});
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto g =
    autd3::gain::Uniform(autd3::EmitIntensity::maximum())
        .with_transform([](const autd3::Device&amp; dev,
                           const autd3::Transducer&amp; tr,
                           autd3::Drive d) -&gt; autd3::Drive {
          d.intensity = autd3::EmitIntensity(d.intensity.value() / 2);
          d.phase = autd3::Phase::from_rad(d.phase.radian() + autd3::pi);
          return d;
        });
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Gain;

var g = new Uniform(EmitIntensity.Max).WithTransform((dev, tr, d) =&gt;
{
    d.Intensity = new EmitIntensity((byte)(d.Intensity.Value / 2));
    d.Phase = Phase.FromRad(d.Phase.Radian + AUTD3.Pi);
    return d;
});
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3 import Drive, EmitIntensity, Phase
from pyautd3.gain import Uniform

g = Uniform(EmitIntensity.maximum()).with_transform(
    lambda dev, tr, d: Drive(
        Phase.from_rad(d.phase.radian + np.pi), EmitIntensity(d.intensity.value // 2)
    )
)
</code></pre>
<p>The argument of <code>with_transform</code> is <code>Fn(&amp;Device, &amp;Transducer, &amp;Drive) -&gt; Drive</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="modulation"><a class="header" href="#modulation">Modulation</a></h1>
<p><code>Modulation</code> is a mechanism to control AM modulation.</p>
<p>The modulation is applied to the amplitude of the sound pressure.
For example, if you use <code>Sine</code> with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span>, the sound pressure amplitude is as follows, and the envelope of the positive part (or negative part) of sound pressure follows the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span> sine wave.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/sine_1k_mod.png"/>
</figure>
<p>Currently, <code>Modulation</code> has the following restrictions.</p>
<ul>
<li>The buffer size is up to 65536.</li>
<li>The sampling rate is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">20.48</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">MHz</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>, where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> is a 32-bit unsigned integer and must be at least 512.</li>
<li>Modulation automatically loops. It is not possible to control only one loop, etc.</li>
<li>The start/end timing of Modulation cannot be controlled.</li>
</ul>
<p>The SDK has <code>Modulation</code> by default to generate several types of AM.</p>
<ul>
<li><a href="Users_Manual/./modulation/static.html">Static</a></li>
<li><a href="Users_Manual/./modulation/sine.html">Sine</a>
<ul>
<li><a href="Users_Manual/./modulation/fourier.html">Fourier</a></li>
</ul>
</li>
<li><a href="Users_Manual/./modulation/square.html">Square</a></li>
<li><a href="Users_Manual/./modulation/wav.html">Wav</a></li>
<li><a href="Users_Manual/./modulation/rawpcm.html">RawPCM</a></li>
<li><a href="Users_Manual/./modulation/cache.html">Cache</a></li>
<li><a href="Users_Manual/./modulation/radiation.html">RadiationPressure</a></li>
<li><a href="Users_Manual/./modulation/transform.html">Transform</a></li>
</ul>
<h2 id="modulation-common-api"><a class="header" href="#modulation-common-api">Modulation common API</a></h2>
<h3 id="sampling-configuration"><a class="header" href="#sampling-configuration">Sampling configuration</a></h3>
<p>You can get the sampling frequency with <code>sampling_config</code>.</p>
<p>Some <code>Modulation</code> can set the sampling configuration with <code>with_sampling_config</code>.
However, due to the constraints of <code>Modulation</code>, the sampling frequency may not be exactly the specified value.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let m = autd3::modulation::Sine::new(150.)
            .with_sampling_config(SamplingConfiguration::from_frequency(4e3)?);
<span class="boring">Ok(())
</span><span class="boring">} </span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(150);
const auto n = m.size();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Modulation;

var m = new Sine(150).WithSamplingConfig(SamplingConfiguration.FromFrequency(4e3));
</code></pre>
<pre><code class="language-python">from pyautd3 import SamplingConfiguration
from pyautd3.modulation import Sine

m = Sine(150).with_sampling_config(SamplingConfiguration.from_frequency(4e3))
</code></pre>
<h3 id="modulation-data-size"><a class="header" href="#modulation-data-size">Modulation data size</a></h3>
<p>The modulation data size can be obtained as follows.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let m = autd3::modulation::Sine::new(150.);
let n = m.len()?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(150).with_sampling_config(
    autd3::SamplingConfiguration::from_frequency(4e3));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Sine(150);
var n = m.Length;
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Sine

m = Sine(150)
n = len(m)
</code></pre>
<h2 id="modulation-delay"><a class="header" href="#modulation-delay">Modulation Delay</a></h2>
<p><code>Modulation</code> is applied to all transducers at the same time without considering propagation delay.
Therefore, there is a possibility that modulation is shifted depending on the distance between the transducer and the focal position.</p>
<p>To compensate for this, each transducer has a function to delay the sampling index to be sampled.</p>
<p>The following example shows how to set the delay of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>-th transducer of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>-th device to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().open_with(autd3::link::Nop::builder()).await?;
</span>autd.send(ConfigureModDelay::new(|dev, tr| {
    if dev.idx() == 0 &amp;&amp; tr.idx() == 0 {
        1
    } else {
        0
    }
})).await?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

autd.send(autd3::ConfigureModDelay([](const autd3::Device&amp; dev,
                                      const autd3::Transducer&amp; tr) {
  return dev.idx() == 0 &amp;&amp; tr.idx() == 0 ? 1 : 0;
}));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;

autd.Send(new ConfigureModDelay((dev, tr) =&gt; return dev.Idx == 0 &amp;&amp; tr.Idx == 0 ? 1 : 0));
</code></pre>
<pre><code class="language-python">from pyautd3 import ConfigureModDelay

autd.send(ConfigureModDelay(lambda dev, tr: 1 if dev.idx == 0 and tr.idx == 0 else 0))
</code></pre>
<p>The delay is the delay for the index to be sampled, so the delay time depends on the sampling frequency of <code>Modulation</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="static"><a class="header" href="#static">Static</a></h1>
<p>Without modulation.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Static::new();
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Static();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Static();
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Static

m = Static()
</code></pre>
<h2 id="set-intensity-3"><a class="header" href="#set-intensity-3">Set intensity</a></h2>
<p>You can set the emission intensity by <code>with_intensity</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Static::new().with_intensity(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m =
    autd3::modulation::Static().with_intensity(autd3::EmitIntensity::minimum());
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Modulation;

var m = new Static().WithIntensity(EmitIntensity.Max);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.modulation import Static

m = Static().with_intensity(EmitIntensity.maximum())
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="sine"><a class="header" href="#sine">Sine</a></h1>
<p><code>Modulation</code> to transform the square of the sound pressure to a sine wave.</p>
<p>Specify the frequency <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> as an integer in the constructor.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Sine::new(150.);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(150);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Sine(150);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Sine

m = Sine(150)
</code></pre>
<h2 id="set-amplitude-and-offset"><a class="header" href="#set-amplitude-and-offset">Set amplitude and offset</a></h2>
<p><code>Sine</code> applies AM so that the waveform of the sound pressure is
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">am</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">se</span><span class="mord mathnormal">t</span></span></span></span></span>
Here, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">am</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">se</span><span class="mord mathnormal">t</span></span></span></span> can be specified by <code>with_intensity</code> and <code>with_offset</code>, respectively (default is <code>EmitIntensity::MAX</code> and <code>EmitIntensity::MAX/2</code>, respectively).</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Sine::new(150.)
            .with_intensity(EmitIntensity::MAX)
            .with_offset(EmitIntensity::MAX / 2);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(150)
                   .with_intensity(autd3::EmitIntensity::maximum())
                   .with_offset(autd3::EmitIntensity::maximum() / 2);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Sine(150)
        .WithIntensity(EmitIntensity.Max)
        .WithOffset(EmitIntensity.Max / 2);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.modulation import Sine

m = (
    Sine(150)
    .with_intensity(EmitIntensity.minimum())
    .with_offset(EmitIntensity.minimum() / 2)
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="fourier"><a class="header" href="#fourier">Fourier</a></h1>
<p><code>Fourier</code> is a modulation that generates a waveform by superimposing multiple <code>Sine</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3::modulation::Fourier;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = Fourier::from(Sine::new(100.))
        .add_component(Sine::new(150.))
        .add_components_from_iter([Sine::new(200.)]);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto m =
    autd3::modulation::Fourier(autd3::modulation::Sine(100))
        .add_component(autd3::modulation::Sine(150))
        .add_components_from_iter(std::vector{autd3::modulation::Sine(200)});
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Fourier(new Sine(100))
        .AddComponent(new Sine(150))
        .AddComponentsFromIter(new[] { new Sine(200) });
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Fourier, Sine

m = Fourier(Sine(100)).add_component(Sine(150)).add_components_from_iter([Sine(200)])
</code></pre>
<p>You can also use <code>+</code> operator.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3::modulation::Fourier;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m: Fourier = Sine::new(100.) + Sine::new(150.) + Sine::new(200.);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(100) + autd3::modulation::Sine(150) +
               autd3::modulation::Sine(200);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Sine(100) + new Sine(150) + new Sine(200);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Fourier, Sine

m = Fourier(Sine(100)) + Sine(150)
</code></pre>
<h2 id="phase-parameter-of-sine"><a class="header" href="#phase-parameter-of-sine">Phase parameter of <code>Sine</code></a></h2>
<p>For <code>Fourier</code>, <code>Sine</code> has a feature to specify the phase parameter.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span>use autd3::modulation::Fourier;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m: Fourier = Sine::new(100.) + Sine::new(150.).with_phase(PI / 2.0);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(100) +
               autd3::modulation::Sine(150).with_phase(autd3::pi / 2.0);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Modulation;

var m = new Sine(100) + new Sine(150).WithPhase(AUTD3.Pi / 2.0);
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3.modulation import Fourier, Sine

m = Fourier(Sine(100)) + Sine(150).with_phase(np.pi / 2.0)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="square"><a class="header" href="#square">Square</a></h1>
<p><code>Modulation</code> to transform sound pressure to a square wave.</p>
<p>Specify the frequency <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> as an integer in the constructor.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Square::new(150.);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Square(150);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Square(150);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Square

m = Square(150)
</code></pre>
<h2 id="set-amplitude"><a class="header" href="#set-amplitude">Set amplitude</a></h2>
<p>You can set the amplitude of the square wave with <code>with_low</code> and <code>with_high</code> for low level and high level, respectively.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Square::new(150.)
            .with_low(EmitIntensity::MIN)
            .with_high(EmitIntensity::MAX);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Square(150)
                   .with_low(autd3::EmitIntensity::minimum())
                   .with_high(autd3::EmitIntensity::maximum());
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Modulation;

var m = new Square(150)
        .WithLow(EmitIntensity.Min)
        .WithHigh(EmitIntensity.Max);
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.modulation import Square

m = Square(150).with_low(EmitIntensity.minimum()).with_high(EmitIntensity.maximum())
</code></pre>
<h2 id="set-duty-ratio"><a class="header" href="#set-duty-ratio">Set duty ratio</a></h2>
<p>You can set the duty ratio of the square wave with <code>with_duty</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main()  {
</span>let m = autd3::modulation::Square::new(150.)
        .with_duty(0.5);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Square(150).with_duty(0.5);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Square(150).WithDuty(0.5);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Square

m = Square(150).with_duty(0.5)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="wav"><a class="header" href="#wav">Wav</a></h1>
<p><code>Wav</code> is a <code>Modulation</code> constructed from a wav file.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3_modulation_audio_file;
</span>use autd3_modulation_audio_file::Wav;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let path = &quot;path/to/foo.wav&quot;;
let m = Wav::new(&amp;path)?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/modulation/audio_file.hpp&quot;

const auto path = &quot;path/to/foo.wav&quot;;
const auto m = autd3::modulation::audio_file::Wav(path);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation.AudioFile;

var path = &quot;path/to/foo.wav&quot;;
var m = new Wav(path);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation.audio_file import Wav

path = &quot;path/to/foo.wav&quot;
m = Wav(path)
</code></pre>
<blockquote>
<p>NOTE: <code>Wav</code> resamples raw pcm file data to the sampling frequency of Modulation.
Please refer to <a href="Users_Manual/modulation/../modulation.html">Modulation</a> for the setting and constraints of the sampling frequency of <code>Modulation</code>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rawpcm"><a class="header" href="#rawpcm">RawPCM</a></h1>
<p><code>RawPCM</code> is a <code>Modulation</code> constructed from raw pcm file.</p>
<pre><code class="language-rust should_panic edition2021"><span class="boring">extern crate autd3_modulation_audio_file;
</span>use autd3_modulation_audio_file::RawPCM;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let path = &quot;path/to/foo.dat&quot;;
let m = RawPCM::new(&amp;path, 4000)?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3/modulation/audio_file.hpp&quot;

const auto path = &quot;path/to/foo.fat&quot;;
const auto m = autd3::modulation::audio_file::RawPCM(path, 4000);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation.AudioFile;

var path = &quot;path/to/foo.dat&quot;;
var m = new RawPCM(path, 4000);
</code></pre>
<pre><code class="language-python">from pyautd3.modulation.audio_file import RawPCM

path = &quot;path/to/foo.dat&quot;
m = RawPCM(path, 4000)
</code></pre>
<p>You need to specify the sampling frequency of this data as the second argument of the constructor.</p>
<blockquote>
<p>NOTE: <code>RawPCM</code> resamples raw pcm file data to the sampling frequency of Modulation.
Please refer to <a href="Users_Manual/modulation/../modulation.html">Modulation</a> for the setting and constraints of the sampling frequency of <code>Modulation</code>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="cache-1"><a class="header" href="#cache-1">Cache</a></h1>
<p>You can cache the calculation result of <code>Modulation</code> by <code>with_cache</code> method.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let c = Static::new().with_cache()?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Static().with_cache();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Static().WithCache();
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Static

m = Static().with_cache()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="radiationpressure"><a class="header" href="#radiationpressure">RadiationPressure</a></h1>
<p><code>RadiationPressure</code> is a <code>Modulation</code> to apply modulation to radiation pressure (proportional to the square of the sound pressure) instead of sound pressure.</p>
<p>For example, if you use <code>RadiationPressure</code> on <code>Sine</code> modulation with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span>, the radiation pressure of the sound pressure amplitude is as follows, and the envelope of the radiation pressure follows the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span> sine wave.</p>
<figure>
  <img src="Users_Manual/modulation/../../fig/Users_Manual/sine_1k_mod_rad.png"/>
</figure>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span>use autd3::prelude::*;

<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let m = Sine::new(150.).with_radiation_pressure();
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &lt;autd3.hpp&gt;

const auto m = autd3::modulation::Sine(150).with_radiation_pressure();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Modulation;

var m = new Sine(150).WithRadiationPressure();
</code></pre>
<pre><code class="language-python">from pyautd3.modulation import Sine

m = Sine(150).with_radiation_pressure()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="transform-1"><a class="header" href="#transform-1">Transform</a></h1>
<p><code>Transform</code> is a feature to apply some post-processing to <code>Modulation</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span>use autd3::prelude::*;
<span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let m = Sine::new(150.).with_transform(|i, d| EmitIntensity::new(d.value() / 2));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto m = autd3::modulation::Sine(150).with_transform(
    [](const size_t idx, const autd3::EmitIntensity d) -&gt; autd3::EmitIntensity {
      return autd3::EmitIntensity(d.value() / 2);
    });
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Modulation;

var m = new Sine(150).WithTransform((i, d) =&gt; new EmitIntensity((byte)(d.Value / 2)));
</code></pre>
<pre><code class="language-python">from pyautd3 import EmitIntensity
from pyautd3.modulation import Sine

m = Sine(150).with_transform(lambda i, d: EmitIntensity(d.value // 2))
</code></pre>
<p><code>with_transform</code> takes <code>Fn(usize, EmitIntensity) -&gt; EmitIntensity</code> as an argument, where the first argument is the index and the second argument is the original modulation data.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="spatio-temporal-modulation"><a class="header" href="#spatio-temporal-modulation">Spatio-Temporal Modulation</a></h1>
<p>SDK provides a function to switch <code>Gain</code> periodically (Spatio-Temporal Modulation, STM).
The SDK provides <code>FocusSTM</code> that supports only a single focus and <code>GainSTM</code> that support arbitrary <code>Gain</code>.
<code>FocusSTM</code> and <code>GainSTM</code> use the timer on the AUTD3 hardware, so the time accuracy is high, but there are many restrictions.</p>
<ul>
<li><a href="Users_Manual/./stm/focus.html">FocusSTM</a></li>
<li><a href="Users_Manual/./stm/gain.html">GainSTM</a></li>
</ul>
<h2 id="focusstmgainstm-common-api"><a class="header" href="#focusstmgainstm-common-api">FocusSTM/GainSTM common API</a></h2>
<h3 id="frequency"><a class="header" href="#frequency">frequency</a></h3>
<p>Get the frequency of STM.</p>
<h3 id="sampling_config"><a class="header" href="#sampling_config">sampling_config</a></h3>
<p>Get the sampling configuration of STM.</p>
<h3 id="start_idxfinish_idx"><a class="header" href="#start_idxfinish_idx">start_idx/finish_idx</a></h3>
<p><code>FocusSTM</code>/<code>GainSTM</code> are usually not specified which focus/<code>Gain</code> to start from.
To specify this, use <code>with_start_idx</code> as follows.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let stm = FocusSTM::new(1.0).with_start_idx(Some(0));
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto stm = autd3::FocusSTM(1).with_start_idx(0);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.STM;

var stm = new FocusSTM(1).WithStartIdx(0);
</code></pre>
<pre><code class="language-python">from pyautd3.stm import FocusSTM

stm = FocusSTM(1).with_start_idx(0)
</code></pre>
<p>This allows you to start from the focus/<code>Gain</code> specified by the index <code>start_idx</code>.</p>
<p>Also, you can specify which focus/<code>Gain</code> to end with <code>finish_idx</code>.</p>
<p>Note that the focus/<code>Gain</code> specified by <code>finish_idx</code> is not output at the end.
The STM output a focus/<code>Gain</code> one before <code>finish_idx</code>, and then the STM ends.</p>
<p><code>start_idx</code> and <code>finish_idx</code> are only valid for transitions from the normal <code>Gain</code> to <code>FocusSTM</code>/<code>GainSTM</code> and from <code>FocusSTM</code>/<code>GainSTM</code> to the normal <code>Gain</code>.</p>
<p>To disable these settings, do the following.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() {
</span>let stm = FocusSTM::new(1.0).with_start_idx(None);
<span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto stm = autd3::FocusSTM(1).with_start_idx(std::nullopt);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.STM;

var stm = new FocusSTM(1).WithStartIdx(null);
</code></pre>
<pre><code class="language-python">from pyautd3.stm import FocusSTM

stm = FocusSTM(1).with_start_idx(None)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="focusstm"><a class="header" href="#focusstm">FocusSTM</a></h1>
<ul>
<li>The maximum number of sampling points is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">65536</span></span></span></span>.</li>
<li>The sampling frequency is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">20.48</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">MHz</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>.</li>
</ul>
<p>THe following is an example of using <code>FocusSTM</code> to focus on a point <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span> directly above the center of the array with a radius of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">30</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span> centered on the center of the array.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().add_device(AUTD3::new(Vector3::zeros())).open_with(autd3::link::Nop::builder()).await?;
</span>let center = autd.geometry.center() + Vector3::new(0., 0., 150.0 * MILLIMETER);
let point_num = 200;
let radius = 30.0 * MILLIMETER;
let stm = FocusSTM::new(1.0).add_foci_from_iter((0..point_num).map(|i| {
    let theta = 2.0 * PI * i as float / point_num as float;
    let p = radius * Vector3::new(theta.cos(), theta.sin(), 0.0);
    center + p
}))?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &lt;ranges&gt;

#include &quot;autd3.hpp&quot;

using namespace std::ranges::views;

const autd3::Vector3 center =
    autd.geometry().center() + autd3::Vector3(0, 0, 150);
const auto points_num = 200;
const auto radius = 30.0;
auto stm = autd3::FocusSTM(1).add_foci_from_iter(
    iota(0) | take(points_num) | transform([&amp;](auto i) {
      const auto theta = 2.0 * autd3::pi * static_cast&lt;double&gt;(i) /
                         static_cast&lt;double&gt;(points_num);
      autd3::Vector3 p = center + autd3::Vector3(radius * std::cos(theta),
                                                 radius * std::sin(theta), 0);
      return p;
    }));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Utils;
using AUTD3Sharp.STM;

var center = autd.Geometry.Center + new Vector3d(0, 0, 150);
const int pointNum = 200;
const double radius = 30.0;
var stm = new FocusSTM(1).AddFociFromIter(Enumerable.Range(0, pointNum).Select(i =&gt;
{
    var theta = 2.0 * Math.PI * i / pointNum;
    return center + radius * new Vector3d(Math.Cos(theta), Math.Sin(theta), 0);
}));
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3.stm import FocusSTM

center = autd.geometry.center + np.array([0.0, 0.0, 150.0])
point_num = 200
radius = 30.0
stm = FocusSTM(1.0).add_foci_from_iter(
    map(
        lambda theta: center + radius * np.array([np.cos(theta), np.sin(theta), 0]),
        map(lambda i: 2.0 * np.pi * i / point_num, range(point_num)),
    )
)
</code></pre>
<p><code>FocusSTM</code>’s constructor takes the STM frequency as an argument.
Note that the specified frequency and the actual frequency may differ due to constraints on the number of sampling points and the sampling period.
For example, the above example runs 200 points at <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span>, so the sampling frequency should be <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">200</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">20.48</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">MHz</span></span></span><span class="mord">/102400</span></span></span></span>.
However, if <code>point_num=199</code>, the sampling frequency must be <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">199</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span></span></span></span>, but there is no integer <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> that satisfies <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord">199</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">Hz</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">20.48</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">MHz</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>.
Therefore, the closest <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> is selected.
As a result, the specified frequency and the actual frequency are shifted.
<code>frequency</code> can be used to check the actual frequency.</p>
<h2 id="specify-the-sampling-configuration"><a class="header" href="#specify-the-sampling-configuration">Specify the sampling configuration</a></h2>
<p>You can specify the sampling frequency by <code>from_sampling_config</code> instead of frequency.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let stm = FocusSTM::from_sampling_config(SamplingConfiguration::from_frequency(1.0)?);
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto stm = autd3::FocusSTM::from_sampling_config(
    autd3::SamplingConfiguration::from_frequency(1));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.STM;

var stm = FocusSTM.FromSamplingConfig(SamplingConfiguration.FromFrequency(1));
</code></pre>
<pre><code class="language-python">from pyautd3 import SamplingConfiguration
from pyautd3.stm import FocusSTM

stm = FocusSTM.from_sampling_config(SamplingConfiguration.from_frequency(1))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="gainstm"><a class="header" href="#gainstm">GainSTM</a></h1>
<p><code>GainSTM</code> can handle arbitrary <code>Gain</code>s, unlike <code>FocusSTM</code>.
However, the number of <code>Gain</code>s that can be used is</p>
<ul>
<li>2048 in Legacy mode</li>
<li>1024 in Advanced/AdvancedPhase mode</li>
</ul>
<p>The following is an example of how to use <code>GainSTM</code>.
This is a sample that rotates the focus on a circle with a radius of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">30</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span> centered on a point <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">150</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">mm</span></span></span></span></span></span> directly above the center of the array.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().open_with(autd3::link::Nop::builder()).await?;
</span>let center = autd.geometry.center() + Vector3::new(0., 0., 150.0 * MILLIMETER);
let point_num = 200;
let radius = 30.0 * MILLIMETER;
let stm = GainSTM::new(1.0).add_gains_from_iter((0..point_num).map(|i| {
    let theta = 2.0 * PI * i as float / point_num as float;
    let p = radius * Vector3::new(theta.cos(), theta.sin(), 0.0);
    Focus::new(center + p)
}))?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &lt;ranges&gt;

#include &quot;autd3.hpp&quot;

using namespace std::ranges::views;

const autd3::Vector3 center =
    autd.geometry().center() + autd3::Vector3(0, 0, 150);
const auto points_num = 200;
const auto radius = 30.0;
auto stm = autd3::GainSTM(1).add_gains_from_iter(
    iota(0) | take(points_num) | transform([&amp;](auto i) {
      const auto theta = 2.0 * autd3::pi * static_cast&lt;double&gt;(i) /
                         static_cast&lt;double&gt;(points_num);
      return autd3::gain::Focus(center +
                                autd3::Vector3(radius * std::cos(theta),
                                               radius * std::sin(theta), 0));
    }));

</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.Utils;
using AUTD3Sharp.STM;
using AUTD3Sharp.Gain;

var center = autd.Geometry.Center + new Vector3d(0, 0, 150);
const int pointNum = 200;
const double radius = 30.0;
var stm = new GainSTM(1.0).AddGainsFromIter(Enumerable.Range(0, pointNum).Select(i =&gt;
{
    var theta = 2.0 * Math.PI * i / pointNum;
    return new Focus(center + radius * new Vector3d(Math.Cos(theta), Math.Sin(theta), 0));
}));
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3.gain import Focus
from pyautd3.stm import GainSTM

center = autd.geometry.center + np.array([0.0, 0.0, 150.0])
point_num = 200
radius = 30.0
stm = GainSTM(1.0).add_gains_from_iter(
    map(
        lambda theta: Focus(
            center + radius * np.array([np.cos(theta), np.sin(theta), 0])
        ),
        map(lambda i: 2.0 * np.pi * i / point_num, range(point_num)),
    )
)
</code></pre>
<h2 id="specify-the-sampling-configuration-1"><a class="header" href="#specify-the-sampling-configuration-1">Specify the sampling configuration</a></h2>
<p>You can specify the sampling frequency by <code>from_sampling_config</code> instead of frequency.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let stm = GainSTM::from_sampling_config(SamplingConfiguration::from_frequency(1.0)?);
<span class="boring">let stm = stm.add_gain(Null::new())?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto stm = autd3::GainSTM::from_sampling_config(
    autd3::SamplingConfiguration::from_frequency(1));
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.STM;

var stm = GainSTM.FromSamplingConfig(SamplingConfiguration.FromFrequency(1));
</code></pre>
<pre><code class="language-python">from pyautd3 import SamplingConfiguration
from pyautd3.stm import GainSTM

stm = GainSTM.from_sampling_config(SamplingConfiguration.from_frequency(1))
</code></pre>
<h2 id="gainstmmode"><a class="header" href="#gainstmmode">GainSTMMode</a></h2>
<p><code>GainSTM</code> sends all phase/amplitude data, so it has a large latency<sup class="footnote-reference"><a href="#fn_gain_seq">1</a></sup>.
To solve this problem, <code>GainSTM</code> has <code>PhaseFull</code> mode that sends only phase and reduces the transmission time by half<sup class="footnote-reference"><a href="#phase_half">2</a></sup>.</p>
<p>This mode can be switched with <code>with_mode</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span>let stm = GainSTM::new(1.0).with_mode(GainSTMMode::PhaseFull);
<span class="boring">let stm = stm.add_gain(Null::new())?;
</span><span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

auto stm = autd3::GainSTM(1).with_mode(autd3::GainSTMMode::PhaseFull);
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;
using AUTD3Sharp.STM;

var stm = new GainSTM(1).WithMode(GainSTMMode.PhaseFull);
</code></pre>
<pre><code class="language-python">from pyautd3.stm import GainSTM, GainSTMMode

stm = GainSTM(1).with_mode(GainSTMMode.PhaseFull)
</code></pre>
<p>The default is <code>PhaseDutyFull</code> mode, which sends all information.</p>
<div class="footnote-definition" id="fn_gain_seq"><sup class="footnote-definition-label">1</sup>
<p>About 75 times of <code>FocusSTM</code></p>
</div>
<div class="footnote-definition" id="phase_half"><sup class="footnote-definition-label">2</sup>
<p>Legacy mode only</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="silencer"><a class="header" href="#silencer">Silencer</a></h1>
<p>AUTD3 has a silencer to mute the output.
The silencer suppresses the rapid change in the drive signal of the transducer and mutes the output.</p>
<h2 id="theory"><a class="header" href="#theory">Theory</a></h2>
<p>The silencer is based on the paper by Suzuki et al.<sup class="footnote-reference"><a href="#suzuki2020">1</a></sup>.</p>
<p>As a rough outline,</p>
<ul>
<li>Amplitude modulation of ultrasound produces audible sound.</li>
<li>When driving an ultrasound transducer, phase changes cause amplitude fluctuations.
<ul>
<li>Therefore, audible noise is generated.</li>
</ul>
</li>
<li>Amplitude fluctuations can be suppressed by linearly interpolating phase changes and changing them stepwise.
<ul>
<li>Therefore, noise can be reduced by doing fine interpolation.</li>
</ul>
</li>
<li>The silencer is a method to reduce noise by doing fine interpolation.</li>
</ul>
<h2 id="silencer-config"><a class="header" href="#silencer-config">Silencer Config</a></h2>
<p>To configure the silencer, send <code>Silencer</code> to the controller.</p>
<p>You can set <code>step</code> to <code>Silencer</code>.
Refer to the followwing for details.
Roughly, the smaller the <code>step</code>, the quieter it becomes.</p>
<p>The silencer is enabled by default.
To disable the silencer, send <code>Silencer::disable</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let step_intensity = 256;
</span><span class="boring">let step_phase = 256;
</span>let config = Silencer::default();
let config = Silencer::new(step_intensity, step_phase);
let config = Silencer::disable();
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

const auto config = autd3::Silencer();
const auto config = autd3::Silencer(step_intensity, step_phase);
const auto config = autd3::Silencer::disable();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp;

var config = new Silencer();
var config = new Silencer(stepIntensity, stepPhase);
var config = Silencer.Disable;
</code></pre>
<pre><code class="language-python">from pyautd3 import Silencer

config = Silencer()
config = Silencer(step_intensity, step_phase)
config = Silencer.disable()
</code></pre>
<h2 id="phase-change-by-silencer"><a class="header" href="#phase-change-by-silencer">Phase change by Silencer</a></h2>
<p>Silencer changes the phase <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> linearly and stepwise to mute the output.
In other words, it is almost equivalent to passing the phase <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> time series data through a (simple) moving average filter.
However, it differs in that it takes into account the fact that the phase data is periodic.</p>
<p>For example, consider the case where the period <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> of the ultrasound is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span>.
In other words, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> corresponds to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">rad</span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span> corresponds to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">rad</span></span></span></span></span>.
Here, suppose that the phase changes from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span> at time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.
The phase change by Silencer is as follows.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/silent/phase.svg"/>
<figcaption>Change of phase <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></figcaption>
</figure>
<p>On the other hand, suppose that the phase changes from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span> at time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.
The phase change by Silencer is as follows.
This is because <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">2</span></span></span></span> is closer to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> than <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span> in terms of the phase.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/silent/phase2.svg"/>
<figcaption>Change of phase <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></figcaption>
</figure>
<p>That is, Silencer updates the phase <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> as follows for the current <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> and the target value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">sign</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∣</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Δ</span><span class="mclose">)</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">sign</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∣</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Δ</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if </span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">/2</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">(otherwise)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">.</span></span></span></span></span>
Where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span> is the update amount per step (<code>step</code> of <code>Silencer</code>).
And the update frequency is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord">40</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">kHz</span></span></span></span></span></span>.</p>
<p>Small <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span> makes the phase change smoother and reduces noise.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/silent/duty.svg"/>
<figcaption>Phase change over <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span></figcaption>
</figure>
<p>According to this implementation, the behavior is different from the moving average filter.
One is when the phase change amount shown above is larger than <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span>, and the other is when the phase changes again in the middle.
Examples of phase changes at this time are shown below.</p>
<figure>
  <img src="Users_Manual/../fig/Users_Manual/silent/mean.svg"/>
<figcaption>Comparison against moving average filter</figcaption>
</figure>
<h2 id="duty-change-by-silencer"><a class="header" href="#duty-change-by-silencer">Duty change by Silencer</a></h2>
<p>Amplitude modulation of ultrasound produces audible sound.
So, AM noise can be reduced by applying a filter to the duty ratio <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>.</p>
<p>Unlike the phase, the duty ratio <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is not periodic with respect to the period <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>.
Therefore, the duty ratio <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is updated as follows for the current <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> and the target value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">sign</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord">∣</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">Δ</span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span></span></p>
<div class="footnote-definition" id="suzuki2020"><sup class="footnote-definition-label">1</sup>
<p>Suzuki, Shun, et al. “Reducing amplitude fluctuation by gradual phase shift in midair ultrasound haptics.” IEEE transactions on haptics 13.1 (2020): 87-93.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="controller"><a class="header" href="#controller">Controller</a></h1>
<p>The followings are introductino of APIs in <code>Controller</code> class.</p>
<ul>
<li><a href="Users_Manual/controller.html#fpga_info">fpga_info</a></li>
<li><a href="Users_Manual/controller.html#send">send</a>
<ul>
<li><a href="Users_Manual/controller.html#timeout">Timeout</a></li>
<li><a href="Users_Manual/controller.html#stop">Stop</a></li>
<li><a href="Users_Manual/controller.html#clear">Clear</a></li>
</ul>
</li>
<li><a href="Users_Manual/controller.html#group">group</a></li>
</ul>
<h2 id="fpga_info"><a class="header" href="#fpga_info">fpga_info</a></h2>
<p>Get the FPGA status.
Before using this, you need to set the <code>reads_fpga_info</code> flag in <code>Device</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().add_device(AUTD3::new(Vector3::zeros())).open_with(autd3::link::Nop::builder()).await?;
</span>autd.geometry[0].reads_fpga_info = true;
autd.send(UpdateFlags::new()).await?;

let info = autd.fpga_info();
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">autd.geometry()[0].reads_fpga_info(true);
autd.send(autd3::UpdateFlags());

const auto info = autd.fpga_info();
</code></pre>
<pre><code class="language-cs">autd.Geometry[0].ReadsFPGAInfo = true;
autd.Send(new UpdateFlags());

var info = autd.FPGAInfo;
</code></pre>
<pre><code class="language-python">from pyautd3 import UpdateFlags

autd.geometry[0].reads_fpga_info = True
autd.send(UpdateFlags())

info = autd.fpga_info
</code></pre>
<p>You can get the following information about the FPGA.</p>
<ul>
<li>thermal sensor for fan control is asserted or not</li>
</ul>
<h2 id="send"><a class="header" href="#send">send</a></h2>
<p>Send the data to the device.</p>
<p>You can send a single or two data at the same time.
However, <code>Stop</code> is an exception and can only be sent alone.</p>
<h3 id="timeout-1"><a class="header" href="#timeout-1">Timeout</a></h3>
<p>You can specify the timeout time with <code>with_timeout</code>.
If you omit this, the timeout time set by <a href="Users_Manual/./link.html">Link</a> will be used.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().open_with(autd3::link::Nop::builder()).await?;
</span><span class="boring">let m = Static::new();
</span><span class="boring">let g = Null::new();
</span>autd.send((m, g).with_timeout(std::time::Duration::from_millis(20))).await?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">autd.send(m, g, std::chrono::milliseconds(20));
</code></pre>
<pre><code class="language-cs">autd.Send((m, g), TimeSpan.FromMilliseconds(20));
</code></pre>
<pre><code class="language-python">from datetime import timedelta

autd.send((m, g), timeout=timedelta(milliseconds=20))
</code></pre>
<p>If the timeout time is greater than 0, the <code>send</code> function waits until the sent data is processed by the device or the specified timeout time elapses.
If it is confirmed that the sent data has been processed by the device, the <code>send</code> function returns <code>true</code>, otherwise it returns <code>false</code>.</p>
<p>If the timeout time is 0, the <code>send</code> function does not check whether the sent data has been processed by the device or not.</p>
<p>If you want to data to be sent surely, it is recommended to set this to an appropriate value.</p>
<h3 id="stop"><a class="header" href="#stop">Stop</a></h3>
<p>You can stop the output by sending <code>Stop</code> data.</p>
<p>Note that the <code>Stop</code> data resets the settings of Silencer.</p>
<h3 id="clear"><a class="header" href="#clear">Clear</a></h3>
<p>You can clear the flags and <code>Gain</code>/<code>Modulation</code> data in the device by sending <code>Clear</code> data.</p>
<h2 id="group-1"><a class="header" href="#group-1">group</a></h2>
<p>You can group the devices by using <code>group</code> function, and send different data to each group.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">use autd3::prelude::*;
</span><span class="boring">#[allow(unused_variables)]
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span class="boring">let mut autd = Controller::builder().add_device(AUTD3::new(Vector3::zeros())).add_device(AUTD3::new(Vector3::zeros())).open_with(autd3::link::Nop::builder()).await?;
</span><span class="boring">let x = 0.;
</span><span class="boring">let y = 0.;
</span><span class="boring">let z = 0.;
</span>autd.group(|dev| match dev.idx() {
        0 =&gt; Some(&quot;focus&quot;),
        1 =&gt; Some(&quot;null&quot;),
        _ =&gt; None,
    })
    .set(&quot;null&quot;, Null::new())?
    .set(&quot;focus&quot;, Focus::new(Vector3::new(x, y, z)))?
    .send().await?;
<span class="boring">Ok(())
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">autd.group([](const autd3::Device&amp; dev) -&gt; std::optional&lt;const char*&gt; {
      if (dev.idx() == 0) {
        return &quot;null&quot;;
      } else if (dev.idx() == 1) {
        return &quot;focus&quot;;
      } else {
        return std::nullopt;
      }
    })
    .set(&quot;null&quot;, autd3::gain::Null())
    .set(&quot;focus&quot;, autd3::gain::Focus(autd3::Vector3(x, y, z)))
    .send_async()
    .get();
</code></pre>
<pre><code class="language-cs">using AUTD3Sharp.Gain;
using AUTD3Sharp.Utils;

await autd.Group(dev =&gt;
    {
        return dev.Idx switch
        {
            0 =&gt; &quot;null&quot;,
            1 =&gt; &quot;focus&quot;,
            _ =&gt; null
        };
    })
    .Set(&quot;null&quot;, new Null())
    .Set(&quot;focus&quot;, new Focus(new Vector3d(x, y, z)))
    .SendAsync();
</code></pre>
<pre><code class="language-python">from pyautd3.gain import Focus, Null


def grouping(dev):
    if dev.idx == 0:
        return &quot;null&quot;
    elif dev.idx == 1:
        return &quot;focus&quot;
    else:
        return None


await (
    autd.group(grouping)
    .set_data(&quot;null&quot;, Null())
    .set_data(&quot;focus&quot;, Focus([x, y, z]))
    .send_async()
)
</code></pre>
<p>Unlike <code>gain::Group</code>, you can use any data that can be sent with <code>send</code> as a value.
However, you can only group by device.</p>
<blockquote>
<p>NOTE:
This sample uses a string as a key, but you can use anything that can be used as a key for HashMap.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="advanced-examples"><a class="header" href="#advanced-examples">Advanced examples</a></h1>
<p>Below are some samples for advanced users.</p>
<ul>
<li><a href="Users_Manual/advanced_examples/./custom_gain.html">Custom Gain Tutorial</a></li>
<li><a href="Users_Manual/advanced_examples/./custom_modulation.html">Custom Modulation Tutorial</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="custom-gain-tutorial"><a class="header" href="#custom-gain-tutorial">Custom Gain Tutorial</a></h1>
<p>You can create your own <code>Gain</code>.</p>
<p>Here, we will define a <code>FocalPoint</code> that generates a single focus just like <code>Focus</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate autd3_driver;
</span>use std::collections::HashMap;
use autd3::{
    derive::Gain,
    prelude::*,
};
use autd3_driver::derive::prelude::*;

#[derive(Gain)]
pub struct FocalPoint {
    position: Vector3,
}

impl FocalPoint {
    pub fn new(position: Vector3) -&gt; Self {
        Self {position}
    }
}

impl Gain for FocalPoint {
    fn calc(&amp;self, geometry: &amp;Geometry, filter: GainFilter) -&gt; Result&lt;HashMap&lt;usize, Vec&lt;Drive&gt;&gt;, AUTDInternalError&gt; {
        Ok(Self::transform(geometry, filter, |dev, tr| Drive {
            phase: Phase::from_rad((tr.position() - self.position).norm() * tr.wavelength(dev.sound_speed)),
            intensity: EmitIntensity::MAX,
        }))
    }
}
<span class="boring">fn main() { 
</span><span class="boring">}
</span><span class="boring"></span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

class FocalPoint final : public autd3::Gain {
 public:
  explicit FocalPoint(autd3::Vector3 point) : _point(std::move(point)) {}

  std::unordered_map&lt;size_t, std::vector&lt;autd3::Drive&gt;&gt; calc(
      const autd3::Geometry&amp; geometry) const override {
    return autd3::Gain::transform(
        geometry, [&amp;](const auto&amp; dev, const auto&amp; tr) {
          const auto phase = (tr.position() - _point).norm() *
                             tr.wavelength(dev.sound_speed());
          return autd3::Drive{autd3::Phase::from_rad(phase),
                              autd3::EmitIntensity::maximum()};
        });
  }

 private:
  autd3::Vector3 _point;
};
</code></pre>
<pre><code class="language-cs">public class FocalPoint : Gain
{
    private readonly Vector3d _point;

    public FocalPoint(Vector3d point)
    {
        _point = point;
    }

    public override Dictionary&lt;int, Drive[]&gt; Calc(Geometry geometry)
    {
        return Transform(geometry, (dev, tr) =&gt;
        {
            var tp = tr.Position;
            var dist = (tp - _point).L2Norm;
            var phase = dist * tr.Wavenumber(dev.SoundSpeed);
            return new Drive { Phase = Phase.FromRad(phase), Intensity = EmitIntensity.Max };
        });
    }
}
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3 import Drive, EmitIntensity, Geometry, Phase
from pyautd3.gain import Gain


class Focus(Gain):
    def __init__(self, point):
        self.point = np.array(point)

    def calc(self, geometry: Geometry) -&gt; dict[int, np.ndarray]:
        return Gain._transform(
            geometry,
            lambda dev, tr: Drive(
                Phase.from_rad(
                    np.linalg.norm(tr.position - self.point)
                    * tr.wavenumber(dev.sound_speed)
                ),
                EmitIntensity.maximum(),
            ),
        )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="custom-modulation-tutorial"><a class="header" href="#custom-modulation-tutorial">Custom Modulation Tutorial</a></h1>
<p>You can create your own <code>Modulation</code> as well as <code>Gain</code>.
Here, we try to create a <code>Burst</code> that outputs only for a certain moment in a cycle.</p>
<p>The following is a sample of <code>Burst</code>.</p>
<pre><code class="language-rust edition2021"><span class="boring">extern crate autd3;
</span><span class="boring">extern crate tokio;
</span><span class="boring">extern crate autd3_driver;
</span>use autd3::{
    derive::Modulation,
};
use autd3_driver::derive::prelude::*;

#[derive(Modulation)]
pub struct Burst {
    config: SamplingConfiguration,
}

impl Burst {
    pub fn new() -&gt; Self {
        Self { config: SamplingConfiguration::from_frequency(4e3).unwrap() }
    }
}

impl Modulation for Burst {
    fn calc(&amp;self) -&gt; Result&lt;Vec&lt;EmitIntensity&gt;, AUTDInternalError&gt; {
        Ok((0..4000)
            .map(|i| if i == 3999 { EmitIntensity::MAX } else { EmitIntensity::MIN })
            .collect())
    }
}
<span class="boring">fn main() { 
</span><span class="boring">}</span></code></pre>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;

class BurstModulation final : public autd3::Modulation {
 public:
  std::vector&lt;autd3::EmitIntensity&gt; calc() const override {
    std::vector buffer(_buf_size, autd3::EmitIntensity::minimum());
    buffer[_buf_size - 1] = autd3::EmitIntensity::maximum();
    return buffer;
  }

  explicit BurstModulation(const size_t buf_size = 4000) noexcept
      : autd3::Modulation(autd3::SamplingConfiguration::from_frequency(4e3)), _buf_size(buf_size) {}

 private:
  size_t _buf_size;
};
</code></pre>
<pre><code class="language-cs">public class Burst : Modulation
{
    private readonly int _length;

    public Burst(int length) : base(SamplingConfiguration.FromFrequency(4e3))
    {
        _length = length;
    }

    public override EmitIntensity[] Calc()
    {
        var buf = Enumerable.Repeat&lt;EmitIntensity&gt;(EmitIntensity.Min, _length).ToArray();
        buf[0] = EmitIntensity.Max;
        return buf;
    }
}
</code></pre>
<pre><code class="language-python">import numpy as np
from pyautd3 import EmitIntensity, SamplingConfiguration
from pyautd3.modulation import Modulation


class Burst(Modulation):
    _length: int

    def __init__(self, length: int = 4000):
        super().__init__(SamplingConfiguration.from_frequency(4e3))
        self._length = length

    def calc(self):
        buf = np.array([EmitIntensity.minimum()] * self._length)
        buf[0] = EmitIntensity.maximum()
        return buf
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="autd3-simulator"><a class="header" href="#autd3-simulator">AUTD3 Simulator</a></h1>
<p>AUTD Simulator is a simulator for AUTD3 supporting Windows, Linux, and macOS.</p>
<h2 id="autd-server-2"><a class="header" href="#autd-server-2">AUTD Server</a></h2>
<p>The simulator is included in <code>AUTD Server</code>.
Download the installer from <a href="https://github.com/shinolab/autd3/releases">GitHub Releases</a>.</p>
<p>When you run <code>AUTD Server</code>, the following screen will appear, so open the “Simulator” tab and click “Run” button.</p>
<figure>
  <img src="Users_Manual/Simulator/../../fig/Users_Manual/autdserver_simulator.jpg"/>
</figure>
<p>When you run the simulator, it is waiting for connection.</p>
<figure>
  <img src="Users_Manual/Simulator/../../fig/sim_waiting.jpg"/>
</figure>
<p>In this state, when you <code>open</code> the <code>Controller</code> using <code>link::Simulator</code>, a black panel will appear on the simulator.</p>
<figure>
  <img src="Users_Manual/Simulator/../../fig/sim_init.jpg"/>
</figure>
<p>This black panel is called “Slice”, and this “Slice” can be used to visualize the sound field at an arbitrary position.
The phase of the transducer is represented by hue, and its amplitude is represented by intensity.</p>
<figure>
  <img src="Users_Manual/Simulator/../../fig/sim_focus.jpg"/>
</figure>
<p>The sound field displayed in the simulator is a simple superposition of spherical waves; directivity and nonlinear effects are not taken into account.</p>
<p>The GUI displayed on the left side of the screen is used to control “Slice” and the camera.
The GUI is based on <a href="https://github.com/ocornut/imgui">Dear ImGui</a>.</p>
<h3 id="slice-tab"><a class="header" href="#slice-tab">Slice tab</a></h3>
<p>In the Slice tab, you can change the size, position, and rotation of the slice.
The rotation is specified in terms of XYZ Euler angles.
The “xy”, “yz”, and “zx” buttons are used to rotate the slice to a position parallel to each plane.</p>
<p>You can select either “Acoustic” mode, which displays the sound pressure, or “Radiation” mode, which displays the square value of the sound pressure.</p>
<p>In the “Color settings” section, you can change the coloring palette, color scale, and alpha value of the slice itself.
If you use a large number of devices, colors may become saturated, in which case you should increase the value of color scale.</p>
<h3 id="camera-tab"><a class="header" href="#camera-tab">Camera tab</a></h3>
<p>In Camera tab, you can change camera position, rotation, field of view, near clip, and far clip.
The rotation is specified in terms of XYZ Euler angles.</p>
<h3 id="config-tab"><a class="header" href="#config-tab">Config tab</a></h3>
<p>In the Config tab, you can set the sound speed, font size, and background color.</p>
<p>You can also switch the show/enable/overheat settings for each device.
When “show” is turned off, the devices contribute to the sound field only by not being displayed.
When “enable” is turned off, it does not contribute to the sound field.</p>
<p>When “View as device” is turned on, the transducers are displayed as AUTD3 3D models instead of simple circles.</p>
<h3 id="info-tab"><a class="header" href="#info-tab">Info tab</a></h3>
<p>In the Info tab, information on FPS, Silencer, Modulation, and STM can be checked.</p>
<p>The Silencer setting can be checked, but it is not affected in the sound field.</p>
<p>When “Mod enable” is set, the modulation is reflected in the sound field.</p>
<p>The index of modulation data and STM is determined by system time.
“System time” represents the system time, which is elapsed time in nanoseconds since January 1, 2000, 0:00:00.</p>
<p>When “Auto play” is set, the system time is automatically incremented.
Other wise, you can set the system time manually.</p>
<h3 id="others"><a class="header" href="#others">Others</a></h3>
<p>“Save image as file” allows you to save an image of the sound field displayed on the current Slice.</p>
<p>“Auto” button automatically moves the camera to the appropriate location.
“Reset” resets the camera to its beggining state.
“Default” resets the camera to the default settings.</p>
<p>The settings are stored in “settings.json”.
One of the settings that can be changed only from this file is <code>vsync</code>: Setting <code>vsync</code> to <code>false</code> disables vertical synchronization.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="faq"><a class="header" href="#faq">FAQ</a></h1>
<ul>
<li><a href="Users_Manual/FAQ/faq.html#no-autd3-devices-found">“No AUTD3 devices found”</a></li>
<li><a href="Users_Manual/FAQ/faq.html#one-ore-more-slaves-are-not-responding">“One ore more slaves are not responding”</a></li>
<li><a href="Users_Manual/FAQ/faq.html#frequent-send-failures-when-using-linksoem">Frequent send failures when using <code>link::SOEM</code></a></li>
<li><a href="Users_Manual/FAQ/faq.html#the-link-is-frequently-broken">The link is frequently broken.</a></li>
<li><a href="Users_Manual/FAQ/faq.html#error-when-using-linkremotetwincat">Error when using <code>link::RemoteTwinCAT</code></a></li>
<li><a href="Users_Manual/FAQ/faq.html#miscellaneous">Miscellaneous</a></li>
</ul>
<h2 id="no-autd3-devices-found"><a class="header" href="#no-autd3-devices-found">“No AUTD3 devices found”</a></h2>
<ul>
<li>
<p>If you use <code>link::SOEM</code> on macOS or linux, you need root privileges.</p>
<ul>
<li>
<p>On linux, you can bypass this by setting the following privileges with the <code>setcap</code> command:</p>
<pre><code class="language-shell">sudo setcap cap_net_raw,cap_net_admin=eip ./examples/example_soem
</code></pre>
</li>
</ul>
</li>
<li>
<p>(Windows) Install the latest npcap</p>
</li>
<li>
<p>Virtual machines such as WSL are not supported.</p>
<ul>
<li>VirtualBox and other virtual machines may work, but the behavior will be unstable.</li>
</ul>
</li>
</ul>
<h2 id="one-ore-more-slaves-are-not-responding"><a class="header" href="#one-ore-more-slaves-are-not-responding">“One ore more slaves are not responding”</a></h2>
<ul>
<li>
<p>Update the driver</p>
<ul>
<li>If you are using Realtek on Windows, please download latest <code>Win10 Auto Installation Program (NDIS)</code> driver from <a href="https://www.realtek.com/ja/component/zoo/category/network-interface-controllers-10-100-1000m-gigabit-ethernet-pci-express-software">official site</a>, and install it.
<ul>
<li>Even if you use Windows 11, you must use NDIS version.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>(Windows) Install the latest npcap.</p>
</li>
<li>
<p>Increase the values of <code>send_cycle</code> and <code>sync0_cycle</code>.</p>
</li>
</ul>
<h2 id="frequent-send-failures-when-using-linksoem"><a class="header" href="#frequent-send-failures-when-using-linksoem">Frequent send failures when using <code>link::SOEM</code></a></h2>
<ul>
<li>
<p>This problem occurs when using the onboard ethernet interface, and one of the following situations</p>
<ul>
<li>Using RealSense, Azure Kinect, webcam, etc.
<ul>
<li>Basically, the problem occurs when the camera is activated.</li>
</ul>
</li>
<li>Playing a video or audio file.
<ul>
<li>Or, open a video site (e.g. Youtube) with an browser.</li>
</ul>
</li>
<li>Using Unity</li>
<li>Playing animation in Blender
<ul>
<li>Other operations (modeling, etc.) are fine.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>As a workaround, try one of the following</p>
<ol>
<li>Use <code>link::TwinCAT</code>, <code>link::RemoteTwinCAT</code>, or <code>link::RemoteSOEM</code></li>
<li>Use a USB to Ethernet adapter
<ul>
<li>It has been confirmed that at least the adapter using the “ASIX AX88179” chip works properly.</li>
<li>The same problem may occur with PCIe ethernet adapters.</li>
</ul>
</li>
<li>Set to <code>FreeRun</code> mode</li>
<li>Increase the values of <code>send_cycle</code> and <code>sync0_cycle</code>
<ul>
<li>In this case, however, the send latency will increase.</li>
</ul>
</li>
<li>Use Linux or macOS.
<ul>
<li>Virtual machines are not acceptable.</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="the-link-is-frequently-broken"><a class="header" href="#the-link-is-frequently-broken">The link is frequently broken.</a></h2>
<ul>
<li>If this occurs frequently during ultrasound output, check if there is enough power.
<ul>
<li>A single device consumes up to 50W.</li>
</ul>
</li>
</ul>
<h2 id="error-when-using-linkremotetwincat"><a class="header" href="#error-when-using-linkremotetwincat">Error when using <code>link::RemoteTwinCAT</code></a></h2>
<ul>
<li>It may be blocked by a firewall, turn off the firewall or allow port 48898 of TCP/UDP.</li>
<li>Disconnect all client PCs from LAN except for the server.</li>
</ul>
<h2 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h2>
<ul>
<li>Please feel free to ask questions or report bugs to <a href="https://github.com/shinolab/autd3/issues">Issue on Github</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="citation"><a class="header" href="#citation">Citation</a></h1>
<p>If you use this SDK in your research, please cite the following paper.</p>
<ul>
<li><a href="https://ieeexplore.ieee.org/document/9392322">S. Suzuki, S. Inoue, M. Fujiwara, Y. Makino and H. Shinoda, “AUTD3: Scalable Airborne Ultrasound Tactile Display,” in IEEE Transactions on Haptics, doi: 10.1109/TOH.2021.3069976.</a></li>
<li>S. Inoue, Y. Makino and H. Shinoda “Scalable Architecture for Airborne Ultrasound Tactile Display”, Asia Haptics 2016</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="license-1"><a class="header" href="#license-1">LICENSE</a></h1>
<p>The autd3 library is MIT licensed.</p>
<p>See <a href="https://github.com/shinolab/autd3/blob/master/LICENSE">LICENSE</a> for details.</p>
<h2 id="3rdparty-library-license"><a class="header" href="#3rdparty-library-license">3rdparty library license</a></h2>
<ul>
<li>SOEM link uses <a href="https://github.com/OpenEtherCATsociety/SOEM">SOEM</a></li>
<li>RemoteTwinCAT link uses <a href="https://github.com/Beckhoff/ADS">ADS</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="release-notes"><a class="header" href="#release-notes">Release Notes</a></h1>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Date</th><th style="text-align: left">Version</th></tr></thead><tbody>
<tr><td style="text-align: left">2022/05/17</td><td style="text-align: left">2.0.0</td></tr>
<tr><td style="text-align: left">2022/05/22</td><td style="text-align: left">2.0.1</td></tr>
<tr><td style="text-align: left">2022/05/24</td><td style="text-align: left">2.0.2</td></tr>
<tr><td style="text-align: left">2022/05/25</td><td style="text-align: left">2.0.3</td></tr>
<tr><td style="text-align: left">2022/06/02</td><td style="text-align: left">2.1.0</td></tr>
<tr><td style="text-align: left">2022/06/10</td><td style="text-align: left">2.2.0</td></tr>
<tr><td style="text-align: left">2022/06/22</td><td style="text-align: left">2.2.1</td></tr>
<tr><td style="text-align: left">2022/06/29</td><td style="text-align: left">2.2.2</td></tr>
<tr><td style="text-align: left">2022/08/08</td><td style="text-align: left">2.3.0</td></tr>
<tr><td style="text-align: left">2022/08/14</td><td style="text-align: left">2.3.1</td></tr>
<tr><td style="text-align: left">2022/09/28</td><td style="text-align: left">2.4.0</td></tr>
<tr><td style="text-align: left">2022/10/09</td><td style="text-align: left">2.4.1</td></tr>
<tr><td style="text-align: left">2022/10/14</td><td style="text-align: left">2.4.2</td></tr>
<tr><td style="text-align: left">2022/10/18</td><td style="text-align: left">2.4.3</td></tr>
<tr><td style="text-align: left">2022/10/21</td><td style="text-align: left">2.4.4</td></tr>
<tr><td style="text-align: left">2022/10/25</td><td style="text-align: left">2.4.5</td></tr>
<tr><td style="text-align: left">2022/11/04</td><td style="text-align: left">2.5.0</td></tr>
<tr><td style="text-align: left">2022/11/06</td><td style="text-align: left">2.5.1</td></tr>
<tr><td style="text-align: left">2022/11/08</td><td style="text-align: left">2.5.2</td></tr>
<tr><td style="text-align: left">2022/11/10</td><td style="text-align: left">2.6.0</td></tr>
<tr><td style="text-align: left">2022/11/13</td><td style="text-align: left">2.6.1</td></tr>
<tr><td style="text-align: left">2022/11/15</td><td style="text-align: left">2.6.2</td></tr>
<tr><td style="text-align: left">2022/11/21</td><td style="text-align: left">2.6.3</td></tr>
<tr><td style="text-align: left">2022/11/22</td><td style="text-align: left">2.6.4</td></tr>
<tr><td style="text-align: left">2022/11/28</td><td style="text-align: left">2.6.5</td></tr>
<tr><td style="text-align: left">2022/12/06</td><td style="text-align: left">2.6.6</td></tr>
<tr><td style="text-align: left">2022/12/10</td><td style="text-align: left">2.6.7</td></tr>
<tr><td style="text-align: left">2022/12/13</td><td style="text-align: left">2.6.8</td></tr>
<tr><td style="text-align: left">2022/12/16</td><td style="text-align: left">2.7.0</td></tr>
<tr><td style="text-align: left">2022/12/24</td><td style="text-align: left">2.7.1</td></tr>
<tr><td style="text-align: left">2022/12/29</td><td style="text-align: left">2.7.2</td></tr>
<tr><td style="text-align: left">2023/01/12</td><td style="text-align: left">2.7.4</td></tr>
<tr><td style="text-align: left">2023/01/17</td><td style="text-align: left">2.7.5</td></tr>
<tr><td style="text-align: left">2023/01/18</td><td style="text-align: left">2.7.6</td></tr>
<tr><td style="text-align: left">2023/01/24</td><td style="text-align: left">2.8.0</td></tr>
<tr><td style="text-align: left">2023/02/02</td><td style="text-align: left">8.1.0</td></tr>
<tr><td style="text-align: left">2023/02/03</td><td style="text-align: left">8.1.1</td></tr>
<tr><td style="text-align: left">2023/02/19</td><td style="text-align: left">8.1.2</td></tr>
<tr><td style="text-align: left">2023/03/10</td><td style="text-align: left">8.2.0</td></tr>
<tr><td style="text-align: left">2023/03/21</td><td style="text-align: left">8.3.0</td></tr>
<tr><td style="text-align: left">2023/04/18</td><td style="text-align: left">8.4.0</td></tr>
<tr><td style="text-align: left">2023/04/23</td><td style="text-align: left">8.4.1</td></tr>
<tr><td style="text-align: left">2023/04/26</td><td style="text-align: left">8.5.0</td></tr>
<tr><td style="text-align: left">2023/04/29</td><td style="text-align: left">9.0.0</td></tr>
<tr><td style="text-align: left">2023/05/01</td><td style="text-align: left">9.0.1</td></tr>
<tr><td style="text-align: left">2023/05/30</td><td style="text-align: left">10.0.0</td></tr>
<tr><td style="text-align: left">2023/06/08</td><td style="text-align: left">11.0.0</td></tr>
<tr><td style="text-align: left">2023/06/09</td><td style="text-align: left">11.0.1</td></tr>
<tr><td style="text-align: left">2023/06/09</td><td style="text-align: left">11.0.2</td></tr>
<tr><td style="text-align: left">2023/06/12</td><td style="text-align: left">11.1.0</td></tr>
<tr><td style="text-align: left">2023/06/21</td><td style="text-align: left">12.0.0</td></tr>
<tr><td style="text-align: left">2023/06/22</td><td style="text-align: left">12.1.0</td></tr>
<tr><td style="text-align: left">2023/06/23</td><td style="text-align: left">12.1.1</td></tr>
<tr><td style="text-align: left">2023/06/24</td><td style="text-align: left">12.2.0</td></tr>
<tr><td style="text-align: left">2023/07/04</td><td style="text-align: left">12.3.0</td></tr>
<tr><td style="text-align: left">2023/07/04</td><td style="text-align: left">12.3.1</td></tr>
<tr><td style="text-align: left">2023/07/11</td><td style="text-align: left">13.0.0</td></tr>
<tr><td style="text-align: left">2023/07/18</td><td style="text-align: left">14.0.0</td></tr>
<tr><td style="text-align: left">2023/07/19</td><td style="text-align: left">14.0.1</td></tr>
<tr><td style="text-align: left">2023/07/27</td><td style="text-align: left">14.1.0</td></tr>
<tr><td style="text-align: left">2023/07/28</td><td style="text-align: left">14.2.0</td></tr>
<tr><td style="text-align: left">2023/08/01</td><td style="text-align: left">14.2.1</td></tr>
<tr><td style="text-align: left">2023/08/07</td><td style="text-align: left">14.2.2</td></tr>
<tr><td style="text-align: left">2023/09/14</td><td style="text-align: left">15.0.2</td></tr>
<tr><td style="text-align: left">2023/09/14</td><td style="text-align: left">15.1.0</td></tr>
<tr><td style="text-align: left">2023/09/15</td><td style="text-align: left">15.1.1</td></tr>
<tr><td style="text-align: left">2023/09/22</td><td style="text-align: left">15.1.2</td></tr>
<tr><td style="text-align: left">2023/09/28</td><td style="text-align: left">15.2.0</td></tr>
<tr><td style="text-align: left">2023/09/29</td><td style="text-align: left">15.2.1</td></tr>
<tr><td style="text-align: left">2023/10/04</td><td style="text-align: left">15.3.0</td></tr>
<tr><td style="text-align: left">2023/10/04</td><td style="text-align: left">15.3.1</td></tr>
<tr><td style="text-align: left">2023/10/14</td><td style="text-align: left">16.0.0</td></tr>
<tr><td style="text-align: left">2023/11/27</td><td style="text-align: left">17.0.0</td></tr>
<tr><td style="text-align: left">2023/11/27</td><td style="text-align: left">17.0.1</td></tr>
<tr><td style="text-align: left">2023/11/28</td><td style="text-align: left">17.0.2</td></tr>
<tr><td style="text-align: left">2023/11/29</td><td style="text-align: left">17.0.3</td></tr>
<tr><td style="text-align: left">2023/12/02</td><td style="text-align: left">18.0.0</td></tr>
<tr><td style="text-align: left">2023/12/04</td><td style="text-align: left">18.0.1</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="document-history"><a class="header" href="#document-history">Document History</a></h1>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Date</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">2022/10/18</td><td style="text-align: left">Version 2.4.3 Initial release</td></tr>
<tr><td style="text-align: left">2022/10/21</td><td style="text-align: left">Version 2.4.4 Initial release</td></tr>
<tr><td style="text-align: left">2022/10/25</td><td style="text-align: left">Version 2.4.5 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/04</td><td style="text-align: left">Version 2.5.0 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/06</td><td style="text-align: left">Version 2.5.1 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/08</td><td style="text-align: left">Version 2.5.2 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/10</td><td style="text-align: left">Version 2.6.0 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/13</td><td style="text-align: left">Version 2.6.1 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/15</td><td style="text-align: left">Version 2.6.2 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/21</td><td style="text-align: left">Version 2.6.3 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/22</td><td style="text-align: left">Version 2.6.4 Initial release</td></tr>
<tr><td style="text-align: left">2022/11/28</td><td style="text-align: left">Version 2.6.5 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/06</td><td style="text-align: left">Version 2.6.6 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/10</td><td style="text-align: left">Version 2.6.7 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/10</td><td style="text-align: left">Version 2.6.8 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/16</td><td style="text-align: left">Version 2.7.0 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/24</td><td style="text-align: left">Version 2.7.1 Initial release</td></tr>
<tr><td style="text-align: left">2022/12/29</td><td style="text-align: left">Version 2.7.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/01/12</td><td style="text-align: left">Version 2.7.4 Initial release</td></tr>
<tr><td style="text-align: left">2023/01/17</td><td style="text-align: left">Version 2.7.5 Initial release</td></tr>
<tr><td style="text-align: left">2023/01/18</td><td style="text-align: left">Version 2.7.6 Initial release</td></tr>
<tr><td style="text-align: left">2023/01/24</td><td style="text-align: left">Version 2.8.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/02/02</td><td style="text-align: left">Version 8.1.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/02/03</td><td style="text-align: left">Version 8.1.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/02/19</td><td style="text-align: left">Version 8.1.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/03/12</td><td style="text-align: left">Version 8.2.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/03/21</td><td style="text-align: left">Version 8.3.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/04/18</td><td style="text-align: left">Version 8.4.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/04/23</td><td style="text-align: left">Version 8.4.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/04/26</td><td style="text-align: left">Version 8.5.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/04/29</td><td style="text-align: left">Version 9.0.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/05/01</td><td style="text-align: left">Version 9.0.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/06/12</td><td style="text-align: left">Version 11.1.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/06/22</td><td style="text-align: left">Version 12.1.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/06/23</td><td style="text-align: left">Version 12.1.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/06/24</td><td style="text-align: left">Version 12.2.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/04</td><td style="text-align: left">Version 12.3.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/04</td><td style="text-align: left">Version 12.3.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/11</td><td style="text-align: left">Version 13.0.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/19</td><td style="text-align: left">Version 14.0.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/27</td><td style="text-align: left">Version 14.1.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/07/28</td><td style="text-align: left">Version 14.2.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/08/01</td><td style="text-align: left">Version 14.2.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/08/07</td><td style="text-align: left">Version 14.2.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/14</td><td style="text-align: left">Version 15.0.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/14</td><td style="text-align: left">Version 15.1.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/15</td><td style="text-align: left">Version 15.1.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/18</td><td style="text-align: left">Version 15.1.1 Update</td></tr>
<tr><td style="text-align: left">2023/09/22</td><td style="text-align: left">Version 15.1.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/28</td><td style="text-align: left">Version 15.2.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/09/29</td><td style="text-align: left">Version 15.2.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/10/04</td><td style="text-align: left">Version 15.3.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/10/04</td><td style="text-align: left">Version 15.3.1 Initial release</td></tr>
<tr><td style="text-align: left">2023/10/14</td><td style="text-align: left">Version 16.0.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/11/28</td><td style="text-align: left">Version 17.0.2 Initial release</td></tr>
<tr><td style="text-align: left">2023/11/29</td><td style="text-align: left">Version 17.0.3 Initial release</td></tr>
<tr><td style="text-align: left">2023/12/02</td><td style="text-align: left">Version 18.0.0 Initial release</td></tr>
<tr><td style="text-align: left">2023/12/04</td><td style="text-align: left">Version 18.0.1 Initial release</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="./theme/codeblock_filename.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
